var r=Object.defineProperty,e=(e,t,o)=>(((e,t,o)=>{t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o})(e,"symbol"!=typeof t?t+"":t,o),o);import{i as t}from"./vendor.40ddfb4b.js";import{C as o}from"./index.b0bd5cc1.js";class s extends Error{constructor(r){super(r),this.name=this.constructor.name,this.message=r,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error(r).stack}}class n extends s{constructor(r,t){super(`${r}:\n  Cause:\n    ${function(r){if(!r)return"";if(r.message)return r.message;const e=r.target;return e?r.target.error&&r.target.error.message?e.error.message:r.target.src?`Failed to load "${e.src}"`:e instanceof XMLHttpRequest?`Network Error: ${e.status||"Unknown Status."} ${e.statusText||"Unknown Error. Possibly a CORS error."}`:`Unknown error on ${e}.`:`Unknown error: "${JSON.stringify(r)}"`}(t).replace(/\n/g,"\n    ")}`),e(this,"originalError"),this.originalError=t,this.stack+="\n"+t.stack}}const a=o.publicRuntimeConfig.apiServer,i=async(r,e,s,i,c)=>{const d=(()=>{const r=localStorage.getItem(o.publicRuntimeConfig.feathersStoreKey);if(null==r||0===r.length)throw new Error(t.t("editor:errors.notAuthenticated"));return r})();return await new Promise(((o,u)=>{const l=new XMLHttpRequest,p=()=>{l.abort();const r=new Error(t.t("editor:errors.uploadAborted"));r.name="AbortError",r.aborted=!0,u(r)};s&&s.addEventListener("abort",p),console.log("Posting to: ",`${a}/media`),l.open("post",`${a}/media`,!0),l.upload.addEventListener("progress",(r=>{e&&e(r.loaded/r.total)})),l.addEventListener("error",(r=>{s&&s.removeEventListener("abort",p),u(new n(t.t("editor:errors.uploadFailed"),r))})),l.addEventListener("load",(()=>{if(s&&s.removeEventListener("abort",p),l.status<300){const r=JSON.parse(l.responseText);o(r)}else u(new Error(t.t("editor:errors.uploadFailed",{reason:l.statusText})))}));const m=new FormData;c&&m.set("projectId",c),i&&m.set("fileIdentifier",i),m.set("media",r),l.setRequestHeader("Authorization",`Bearer ${d}`),l.send(m)}))};export{i as u};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLjg4OTUwNzdlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9lbmdpbmUvc3JjL3NjZW5lL2Z1bmN0aW9ucy9lcnJvcnMudHMiLCIuLi8uLi8uLi9lbmdpbmUvc3JjL3NjZW5lL2Z1bmN0aW9ucy91cGxvYWQudHN4IiwiLi4vLi4vLi4vZW5naW5lL3NyYy9zY2VuZS9mdW5jdGlvbnMvZ2V0VG9rZW4udHN4Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGV2ZW50VG9NZXNzYWdlKGV2ZW50KSB7XG4gIGlmICghZXZlbnQpIHJldHVybiAnJ1xuICBpZiAoZXZlbnQubWVzc2FnZSkgcmV0dXJuIGV2ZW50Lm1lc3NhZ2VcbiAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0XG4gIGlmICh0YXJnZXQpIHtcbiAgICBpZiAoZXZlbnQudGFyZ2V0LmVycm9yICYmIGV2ZW50LnRhcmdldC5lcnJvci5tZXNzYWdlKSByZXR1cm4gdGFyZ2V0LmVycm9yLm1lc3NhZ2VcbiAgICBpZiAoZXZlbnQudGFyZ2V0LnNyYykgcmV0dXJuIGBGYWlsZWQgdG8gbG9hZCBcIiR7dGFyZ2V0LnNyY31cImBcbiAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgWE1MSHR0cFJlcXVlc3QpIHtcbiAgICAgIHJldHVybiBgTmV0d29yayBFcnJvcjogJHt0YXJnZXQuc3RhdHVzIHx8ICdVbmtub3duIFN0YXR1cy4nfSAke1xuICAgICAgICB0YXJnZXQuc3RhdHVzVGV4dCB8fCAnVW5rbm93biBFcnJvci4gUG9zc2libHkgYSBDT1JTIGVycm9yLidcbiAgICAgIH1gXG4gICAgfVxuICAgIHJldHVybiBgVW5rbm93biBlcnJvciBvbiAke3RhcmdldH0uYFxuICB9XG4gIHJldHVybiBgVW5rbm93biBlcnJvcjogXCIke0pTT04uc3RyaW5naWZ5KGV2ZW50KX1cImBcbn1cbi8vIEJhc2UgZXJyb3IgY2xhc3MgdG8gYmUgdXNlZCBmb3IgYWxsIGN1c3RvbSBlcnJvcnMuXG5leHBvcnQgY2xhc3MgQmFzZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgc3VwZXIobWVzc2FnZSlcbiAgICB0aGlzLm5hbWUgPSB0aGlzLmNvbnN0cnVjdG9yLm5hbWVcbiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlXG4gICAgaWYgKHR5cGVvZiBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgdGhpcy5jb25zdHJ1Y3RvcilcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdGFjayA9IG5ldyBFcnJvcihtZXNzYWdlKS5zdGFja1xuICAgIH1cbiAgfVxufVxuLy8gT3ZlcnJpZGUgdGhlIG1lc3NhZ2Ugb2YgYW4gZXJyb3IgYnV0IGFwcGVuZCB0aGUgZXhpc3Rpbmcgc3RhY2sgdHJhY2UuXG5leHBvcnQgY2xhc3MgUmV0aHJvd25FcnJvciBleHRlbmRzIEJhc2VFcnJvciB7XG4gIG9yaWdpbmFsRXJyb3JcbiAgY29uc3RydWN0b3IobWVzc2FnZSwgZXJyb3IpIHtcbiAgICBzdXBlcihgJHttZXNzYWdlfTpcXG4gIENhdXNlOlxcbiAgICAke2V2ZW50VG9NZXNzYWdlKGVycm9yKS5yZXBsYWNlKC9cXG4vZywgJ1xcbiAgICAnKX1gKVxuICAgIHRoaXMub3JpZ2luYWxFcnJvciA9IGVycm9yXG4gICAgdGhpcy5zdGFjayArPSAnXFxuJyArIGVycm9yLnN0YWNrXG4gIH1cbn1cbi8vIE91dHB1dCBtZXNzYWdlcyBmb3IgbXVsdGlwbGUgZXJyb3JzLlxuLy9cbi8vIEV4YW1wbGU6IG5ldyBNdWx0aUVycm9yKFwiRXJyb3IgbG9hZGluZyBwcm9qZWN0XCIsIGVycm9ycyk7XG4vLyBPdXRwdXQ6XG4vLyAgRXJyb3IgbG9hZGluZyBwcm9qZWN0OlxuLy9cbi8vICAyIEVycm9yczpcbi8vICAgIE1vZGVsIFwiRXhhbXBsZSBNb2RlbFwiIGNvdWxkIG5vdCBiZSBsb2FkZWQ6XG4vLyAgICAgIENhdXNlOlxuLy8gICAgICAgIE5ldHdvcmsgRXJyb3I6IFVua25vd24gZXJyb3IuIFBvc3NpYmx5IGNhdXNlZCBieSBpbXByb3BlciBDT1JTIGhlYWRlcnMuXG4vLyAgICBJbWFnZSBcIkV4YW1wbGUgSW1hZ2VcIiBjb3VsZCBub3QgYmUgbG9hZGVkLlxuLy8gICAgICBOZXR3b3JrIEVycm9yOiA0MDQgUGFnZSBub3QgZm91bmQuXG5leHBvcnQgY2xhc3MgTXVsdGlFcnJvciBleHRlbmRzIEJhc2VFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIGVycm9ycykge1xuICAgIGxldCBmaW5hbE1lc3NhZ2UgPSBgJHttZXNzYWdlfTpcXG5cXG4ke2Vycm9ycy5sZW5ndGh9IEVycm9yJHtlcnJvcnMubGVuZ3RoID4gMSA/ICdzJyA6ICcnfTpgXG4gICAgZm9yIChjb25zdCBlcnJvciBvZiBlcnJvcnMpIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVycm9yLm1lc3NhZ2UgPyBlcnJvci5tZXNzYWdlLnJlcGxhY2UoL1xcbi9nLCAnXFxuICAnKSA6ICdVbmtub3duIEVycm9yJ1xuICAgICAgZmluYWxNZXNzYWdlICs9ICdcXG4gICcgKyBlcnJvck1lc3NhZ2VcbiAgICB9XG4gICAgc3VwZXIoZmluYWxNZXNzYWdlKVxuICB9XG59XG4iLCJpbXBvcnQgeyBSZXRocm93bkVycm9yIH0gZnJvbSAnLi4vLi4vc2NlbmUvZnVuY3Rpb25zL2Vycm9ycydcbmltcG9ydCBpMThuIGZyb20gJ2kxOG5leHQnXG5pbXBvcnQgeyBBdWRpb0ZpbGVUeXBlcyB9IGZyb20gJy4uLy4uL2Fzc2V0cy9jb25zdGFudHMvZmlsZVR5cGVzJ1xuaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICcuL2dldFRva2VuJ1xuaW1wb3J0IHsgQ29uZmlnIH0gZnJvbSAnQHhyZW5naW5lL2NvbW1vbi9zcmMvY29uZmlnJ1xuXG5jb25zdCBzZXJ2ZXJVUkwgPSBDb25maWcucHVibGljUnVudGltZUNvbmZpZy5hcGlTZXJ2ZXJcblxubGV0IGxhc3RVcGxvYWRBc3NldFJlcXVlc3QgPSAwXG5cbi8qKlxuICogdXBsb2FkIHVzZWQgdG8gdXBsb2FkIGltYWdlIGFzIGJsb2IgZGF0YS5cbiAqXG4gKiBAYXV0aG9yIFJvYmVydCBMb25nXG4gKiBAcGFyYW0gIHthbnl9ICBibG9iXG4gKiBAcGFyYW0gIHthbnl9ICBvblVwbG9hZFByb2dyZXNzXG4gKiBAcGFyYW0gIHthbnl9ICBzaWduYWxcbiAqIEBwYXJhbSAge2FueX0gIHByb2plY3RJZFxuICogQHBhcmFtICB7c3RyaW5nfSAgZmlsZUlkZW50aWZpZXJcbiAqIEByZXR1cm4ge1Byb21pc2V9XG4gKi9cblxuZXhwb3J0IGNvbnN0IHVwbG9hZCA9IGFzeW5jIChibG9iLCBvblVwbG9hZFByb2dyZXNzLCBzaWduYWw/LCBmaWxlSWRlbnRpZmllcj8sIHByb2plY3RJZD8pOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgY29uc3QgdG9rZW4gPSBnZXRUb2tlbigpXG5cbiAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KClcbiAgICBjb25zdCBvbkFib3J0ID0gKCkgPT4ge1xuICAgICAgcmVxdWVzdC5hYm9ydCgpXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihpMThuLnQoJ2VkaXRvcjplcnJvcnMudXBsb2FkQWJvcnRlZCcpKVxuICAgICAgZXJyb3IubmFtZSA9ICdBYm9ydEVycm9yJ1xuICAgICAgZXJyb3JbJ2Fib3J0ZWQnXSA9IHRydWVcbiAgICAgIHJlamVjdChlcnJvcilcbiAgICB9XG5cbiAgICBpZiAoc2lnbmFsKSB7XG4gICAgICBzaWduYWwuYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBvbkFib3J0KVxuICAgIH1cbiAgICBjb25zb2xlLmxvZygnUG9zdGluZyB0bzogJywgYCR7c2VydmVyVVJMfS9tZWRpYWApXG5cbiAgICByZXF1ZXN0Lm9wZW4oJ3Bvc3QnLCBgJHtzZXJ2ZXJVUkx9L21lZGlhYCwgdHJ1ZSlcblxuICAgIHJlcXVlc3QudXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoJ3Byb2dyZXNzJywgKGUpID0+IHtcbiAgICAgIGlmIChvblVwbG9hZFByb2dyZXNzKSB7XG4gICAgICAgIG9uVXBsb2FkUHJvZ3Jlc3MoZS5sb2FkZWQgLyBlLnRvdGFsKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKGVycm9yKSA9PiB7XG4gICAgICBpZiAoc2lnbmFsKSB7XG4gICAgICAgIHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCdhYm9ydCcsIG9uQWJvcnQpXG4gICAgICB9XG4gICAgICByZWplY3QobmV3IFJldGhyb3duRXJyb3IoaTE4bi50KCdlZGl0b3I6ZXJyb3JzLnVwbG9hZEZhaWxlZCcpLCBlcnJvcikpXG4gICAgfSlcblxuICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcbiAgICAgIGlmIChzaWduYWwpIHtcbiAgICAgICAgc2lnbmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0Jywgb25BYm9ydClcbiAgICAgIH1cblxuICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzIDwgMzAwKSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlVGV4dClcbiAgICAgICAgcmVzb2x2ZShyZXNwb25zZSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoaTE4bi50KCdlZGl0b3I6ZXJyb3JzLnVwbG9hZEZhaWxlZCcsIHsgcmVhc29uOiByZXF1ZXN0LnN0YXR1c1RleHQgfSkpKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpXG4gICAgaWYgKHByb2plY3RJZCkge1xuICAgICAgZm9ybURhdGEuc2V0KCdwcm9qZWN0SWQnLCBwcm9qZWN0SWQpXG4gICAgfVxuICAgIGlmIChmaWxlSWRlbnRpZmllcikge1xuICAgICAgZm9ybURhdGEuc2V0KCdmaWxlSWRlbnRpZmllcicsIGZpbGVJZGVudGlmaWVyKVxuICAgIH1cblxuICAgIGZvcm1EYXRhLnNldCgnbWVkaWEnLCBibG9iKVxuICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHt0b2tlbn1gKVxuXG4gICAgcmVxdWVzdC5zZW5kKGZvcm1EYXRhKVxuICB9KVxufVxuLyoqXG4gKiB1cGxvYWRBc3NldHMgdXNlZCB0byB1cGxvYWQgYXNzZXQgZmlsZXMuXG4gKlxuICogQGF1dGhvciBSb2JlcnQgTG9uZ1xuICogQHBhcmFtICB7YW55fSBlZGl0b3IgICAgIFtjb250YWlucyBlZGl0b3IgZGF0YV1cbiAqIEBwYXJhbSAge2FueX0gZmlsZXMgICAgICBbZmlsZXMgZm9yIHVwbG9hZF1cbiAqIEBwYXJhbSAge2FueX0gb25Qcm9ncmVzc1xuICogQHBhcmFtICB7YW55fSBzaWduYWxcbiAqIEByZXR1cm4ge2FueX0gICAgICAgICAgICBbdXBsb2FkZWQgZmlsZSBhc3NldHNdXG4gKi9cbmV4cG9ydCBjb25zdCB1cGxvYWRBc3NldHMgPSBhc3luYyAoZWRpdG9yLCBmaWxlcywgb25Qcm9ncmVzcywgc2lnbmFsKTogUHJvbWlzZTxhbnk+ID0+IHtcbiAgcmV0dXJuIGF3YWl0IF91cGxvYWRBc3NldHMoYCR7c2VydmVyVVJMfS9zdGF0aWMtcmVzb3VyY2VgLCBlZGl0b3IsIGZpbGVzLCBvblByb2dyZXNzLCBzaWduYWwpXG59XG4vKipcbiAqIF91cGxvYWRBc3NldHMgdXNlZCBhcyBhcGkgaGFuZGxlciBmb3IgdXBsb2FkQXNzZXQuXG4gKlxuICogQGF1dGhvciBSb2JlcnQgTG9uZ1xuICogQHBhcmFtICB7YW55fSAgZW5kcG9pbnRcbiAqIEBwYXJhbSAge2FueX0gIGVkaXRvclxuICogQHBhcmFtICB7YW55fSAgZmlsZXNcbiAqIEBwYXJhbSAge2FueX0gIG9uUHJvZ3Jlc3NcbiAqIEBwYXJhbSAge2FueX0gIHNpZ25hbFxuICogQHJldHVybiB7UHJvbWlzZX0gICAgICAgICAgICBbYXNzZXRzIGZpbGUgZGF0YV1cbiAqL1xuXG5leHBvcnQgY29uc3QgX3VwbG9hZEFzc2V0cyA9IGFzeW5jIChlbmRwb2ludCwgZWRpdG9yLCBmaWxlcywgb25Qcm9ncmVzcywgc2lnbmFsKTogUHJvbWlzZTxhbnk+ID0+IHtcbiAgY29uc3QgYXNzZXRzID0gW11cblxuICBmb3IgKGNvbnN0IGZpbGUgb2YgQXJyYXkuZnJvbShmaWxlcykpIHtcbiAgICBpZiAoc2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgIGJyZWFrXG4gICAgfVxuXG4gICAgY29uc3QgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpXG4gICAgY29uc3Qgb25BYm9ydCA9ICgpID0+IGFib3J0Q29udHJvbGxlci5hYm9ydCgpXG4gICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0Jywgb25BYm9ydClcblxuICAgIGNvbnN0IGFzc2V0ID0gYXdhaXQgX3VwbG9hZEFzc2V0KFxuICAgICAgZW5kcG9pbnQsXG4gICAgICBlZGl0b3IsXG4gICAgICBmaWxlLFxuICAgICAgKHByb2dyZXNzKSA9PiBvblByb2dyZXNzKGFzc2V0cy5sZW5ndGggKyAxLCBmaWxlcy5sZW5ndGgsIHByb2dyZXNzKSxcbiAgICAgIGFib3J0Q29udHJvbGxlci5zaWduYWxcbiAgICApXG5cbiAgICBhc3NldHMucHVzaChhc3NldClcbiAgICBzaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBvbkFib3J0KVxuXG4gICAgaWYgKHNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBhc3NldHNcbn1cbi8qKlxuICogdXBsb2FkQXNzZXQgdXNlZCB0byB1cGxvYWQgc2luZ2xlIGZpbGUgYXMgYXNzZXQuXG4gKlxuICogQGF1dGhvciBSb2JlcnQgTG9uZ1xuICogQHBhcmFtIHthbnl9IGVkaXRvclxuICogQHBhcmFtIHthbnl9IGZpbGVcbiAqIEBwYXJhbSB7YW55fSBvblByb2dyZXNzXG4gKiBAcGFyYW0ge2FueX0gc2lnbmFsXG4gKi9cblxuZXhwb3J0IGNvbnN0IHVwbG9hZEFzc2V0ID0gKGVkaXRvciwgZmlsZSwgb25Qcm9ncmVzcywgc2lnbmFsKTogYW55ID0+IHtcbiAgcmV0dXJuIF91cGxvYWRBc3NldChgJHtzZXJ2ZXJVUkx9L3N0YXRpYy1yZXNvdXJjZWAsIGVkaXRvciwgZmlsZSwgb25Qcm9ncmVzcywgc2lnbmFsKVxufVxuXG4vKipcbiAqIG1hdGNoZXNGaWxlVHlwZXMgZnVuY3Rpb24gdXNlZCB0byBtYXRjaCBmaWxlIHR5cGUgd2l0aCBleGlzdGluZyBmaWxlIHR5cGVzLlxuICpcbiAqIEBhdXRob3IgUm9iZXJ0IExvbmdcbiAqIEBwYXJhbSAge09iamVjdH0gZmlsZSAgICAgIFtvYmplY3QgY29udGFpbnMgZmlsZSBkYXRhXVxuICogQHBhcmFtICB7YXJyYXl9IGZpbGVUeXBlcyBbQXJyYXkgY29udGFpbnMgZXhpc3RpbmcgZmlsZSB0eXBlc11cbiAqIEByZXR1cm4ge2Jvb2xlYW59ICAgICAgICAgICBbdHJ1ZSBpZiBmaWxlIHR5cGUgZm91bmQgaW4gZXhpc3RpbmcgZmlsZVR5cGVzXVxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBtYXRjaGVzRmlsZVR5cGVzKGZpbGUsIGZpbGVUeXBlcykge1xuICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgZmlsZVR5cGVzKSB7XG4gICAgaWYgKHBhdHRlcm4uc3RhcnRzV2l0aCgnLicpKSB7XG4gICAgICBpZiAoZmlsZS5uYW1lLnRvTG93ZXJDYXNlKCkuZW5kc1dpdGgocGF0dGVybikpIHtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGZpbGUudHlwZS5zdGFydHNXaXRoKHBhdHRlcm4pKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2Vcbn1cblxuLyoqXG4gKiB1cGxvYWRQcm9qZWN0QXNzZXQgdXNlZCB0byBjYWxsIF91cGxvYWRBc3NldCBkaXJlY3RseS5cbiAqXG4gKiBAYXV0aG9yIFJvYmVydCBMb25nXG4gKiBAcGFyYW0ge2FueX0gZWRpdG9yXG4gKiBAcGFyYW0ge2FueX0gcHJvamVjdElkXG4gKiBAcGFyYW0ge2FueX0gZmlsZVxuICogQHBhcmFtIHthbnl9IG9uUHJvZ3Jlc3NcbiAqIEBwYXJhbSB7YW55fSBzaWduYWxcbiAqL1xuXG5leHBvcnQgY29uc3QgdXBsb2FkUHJvamVjdEFzc2V0ID0gKGVkaXRvciwgcHJvamVjdElkLCBmaWxlLCBvblByb2dyZXNzLCBzaWduYWwpOiBhbnkgPT4ge1xuICByZXR1cm4gX3VwbG9hZEFzc2V0KGAke3NlcnZlclVSTH0vcHJvamVjdC8ke3Byb2plY3RJZH0vYXNzZXRzYCwgZWRpdG9yLCBmaWxlLCBvblByb2dyZXNzLCBzaWduYWwpXG59XG4vKipcbiAqIF91cGxvYWRBc3NldCB1c2VkIGFzIGFwaSBoYW5kbGVyIGZvciB0aGUgdXBsb2FkQXNzZXQuXG4gKlxuICogQGF1dGhvciBSb2JlcnQgTG9uZ1xuICogQHBhcmFtICB7YW55fSAgZW5kcG9pbnRcbiAqIEBwYXJhbSAge2FueX0gIGVkaXRvclxuICogQHBhcmFtICB7YW55fSAgZmlsZVxuICogQHBhcmFtICB7YW55fSAgb25Qcm9ncmVzc1xuICogQHBhcmFtICB7YW55fSAgc2lnbmFsXG4gKiBAcmV0dXJuIHtQcm9taXNlfSAgICAgICAgICAgIFt1cGxvYWRlZCBhc3NldCBmaWxlIGRhdGFdXG4gKi9cblxuZXhwb3J0IGNvbnN0IF91cGxvYWRBc3NldCA9IGFzeW5jIChlbmRwb2ludCwgZWRpdG9yLCBmaWxlLCBvblByb2dyZXNzLCBzaWduYWwpOiBQcm9taXNlPGFueT4gPT4ge1xuICBsZXQgdGh1bWJuYWlsRmlsZUlkID0gbnVsbFxuICBsZXQgdGh1bWJuYWlsQWNjZXNzVG9rZW4gPSBudWxsXG5cbiAgaWYgKCFtYXRjaGVzRmlsZVR5cGVzKGZpbGUsIEF1ZGlvRmlsZVR5cGVzKSkge1xuICAgIGNvbnN0IHRodW1ibmFpbEJsb2IgPSBhd2FpdCBlZGl0b3IuZ2VuZXJhdGVGaWxlVGh1bWJuYWlsKGZpbGUpXG5cbiAgICBjb25zdCByZXNwb25zZSA9IChhd2FpdCB1cGxvYWQodGh1bWJuYWlsQmxvYiwgdW5kZWZpbmVkLCBzaWduYWwpKSBhcyBhbnlcblxuICAgIHRodW1ibmFpbEZpbGVJZCA9IHJlc3BvbnNlLmZpbGVfaWRcbiAgICB0aHVtYm5haWxBY2Nlc3NUb2tlbiA9IHJlc3BvbnNlLm1ldGEuYWNjZXNzX3Rva2VuXG4gIH1cblxuICBjb25zdCB7XG4gICAgZmlsZV9pZDogYXNzZXRGaWxlSWQsXG4gICAgbWV0YTogeyBhY2Nlc3NfdG9rZW46IGFzc2V0QWNjZXNzVG9rZW4sIGV4cGVjdGVkX2NvbnRlbnRfdHlwZTogZXhwZWN0ZWRDb250ZW50VHlwZSB9LFxuICAgIG9yaWdpbjogb3JpZ2luXG4gIH0gPSAoYXdhaXQgdXBsb2FkKGZpbGUsIG9uUHJvZ3Jlc3MsIHNpZ25hbCkpIGFzIGFueVxuXG4gIGNvbnN0IGRlbHRhID0gRGF0ZS5ub3coKSAtIGxhc3RVcGxvYWRBc3NldFJlcXVlc3RcblxuICBpZiAoZGVsdGEgPCAxMTAwKSB7XG4gICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTEwMCAtIGRlbHRhKSlcbiAgfVxuXG4gIGNvbnN0IHRva2VuID0gZ2V0VG9rZW4oKVxuXG4gIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YFxuICB9XG5cbiAgY29uc3QgYm9keSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICBhc3NldDoge1xuICAgICAgbmFtZTogZmlsZS5uYW1lLFxuICAgICAgZmlsZV9pZDogYXNzZXRGaWxlSWQsXG4gICAgICBhY2Nlc3NfdG9rZW46IGFzc2V0QWNjZXNzVG9rZW4sXG4gICAgICB0aHVtYm5haWxfZmlsZV9pZDogdGh1bWJuYWlsRmlsZUlkLFxuICAgICAgdGh1bWJuYWlsX2FjY2Vzc190b2tlbjogdGh1bWJuYWlsQWNjZXNzVG9rZW5cbiAgICB9XG4gIH0pXG5cbiAgbGFzdFVwbG9hZEFzc2V0UmVxdWVzdCA9IERhdGUubm93KClcblxuICByZXR1cm4ge1xuICAgIGlkOiBhc3NldEZpbGVJZCxcbiAgICBuYW1lOiBmaWxlLm5hbWUsXG4gICAgdXJsOiBvcmlnaW4sXG4gICAgdHlwZTogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gICAgaW1hZ2VzOiB7XG4gICAgICBwcmV2aWV3OiB7IHVybDogZmlsZS50aHVtYm5haWxfdXJsIH1cbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCBpMThuIGZyb20gJ2kxOG5leHQnXG5pbXBvcnQgeyBDb25maWcgfSBmcm9tICdAeHJlbmdpbmUvY29tbW9uL3NyYy9jb25maWcnXG5cbi8qKlxuICogZ2V0VG9rZW4gdXNlZCB0byBnZXQgdGhlIHRva2VuIG9mIGxvZ2luZWQgdXNlci5cbiAqXG4gKiBAYXV0aG9yIFJvYmVydCBMb25nXG4gKiBAcmV0dXJuIHtzdHJpbmd9ICAgICAgICBbcmV0dXJucyB0b2tlbiBzdHJpbmddXG4gKi9cblxuZXhwb3J0IGNvbnN0IGdldFRva2VuID0gKCk6IHN0cmluZyA9PiB7XG4gIGNvbnN0IHRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oQ29uZmlnLnB1YmxpY1J1bnRpbWVDb25maWcuZmVhdGhlcnNTdG9yZUtleSlcblxuICBpZiAodG9rZW4gPT0gbnVsbCB8fCB0b2tlbi5sZW5ndGggPT09IDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoaTE4bi50KCdlZGl0b3I6ZXJyb3JzLm5vdEF1dGhlbnRpY2F0ZWQnKSlcbiAgfVxuXG4gIHJldHVybiB0b2tlblxufVxuIl0sIm5hbWVzIjpbIkVycm9yIiwiY29uc3RydWN0b3IiLCJtZXNzYWdlIiwibmFtZSIsInRoaXMiLCJjYXB0dXJlU3RhY2tUcmFjZSIsInN0YWNrIiwiQmFzZUVycm9yIiwiZXJyb3IiLCJldmVudCIsInRhcmdldCIsInNyYyIsIlhNTEh0dHBSZXF1ZXN0Iiwic3RhdHVzIiwic3RhdHVzVGV4dCIsIkpTT04iLCJzdHJpbmdpZnkiLCJldmVudFRvTWVzc2FnZSIsInJlcGxhY2UiLCJvcmlnaW5hbEVycm9yIiwic2VydmVyVVJMIiwiQ29uZmlnIiwicHVibGljUnVudGltZUNvbmZpZyIsImFwaVNlcnZlciIsInVwbG9hZCIsImFzeW5jIiwiYmxvYiIsIm9uVXBsb2FkUHJvZ3Jlc3MiLCJzaWduYWwiLCJmaWxlSWRlbnRpZmllciIsInByb2plY3RJZCIsInRva2VuIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImZlYXRoZXJzU3RvcmVLZXkiLCJsZW5ndGgiLCJpMThuIiwidCIsImdldFRva2VuIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJyZXF1ZXN0Iiwib25BYm9ydCIsImFib3J0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImxvZyIsIm9wZW4iLCJlIiwibG9hZGVkIiwidG90YWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiUmV0aHJvd25FcnJvciIsInJlc3BvbnNlIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJyZWFzb24iLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwic2V0Iiwic2V0UmVxdWVzdEhlYWRlciIsInNlbmQiXSwibWFwcGluZ3MiOiJpUUFpQitCQSxNQUM3QkMsWUFBWUMsU0FDSkEsUUFDREMsS0FBT0MsS0FBS0gsWUFBWUUsVUFDeEJELFFBQVVBLEVBQ3dCLG1CQUE1QkYsTUFBTUssd0JBQ1RBLGtCQUFrQkQsS0FBTUEsS0FBS0gsa0JBRTlCSyxNQUFRLElBQUlOLE1BQU1FLEdBQVNJLHVCQUtIQyxFQUVqQ04sWUFBWUMsRUFBU00sU0FDYixHQUFHTiw4QkFqQzBCTyxPQUNoQ0EsUUFBYyxNQUNmQSxFQUFNUCxlQUFnQk8sRUFBTVAsY0FDMUJRLEVBQVNELEVBQU1DLGNBQ2pCQSxFQUNFRCxFQUFNQyxPQUFPRixPQUFTQyxFQUFNQyxPQUFPRixNQUFNTixRQUFnQlEsRUFBT0YsTUFBTU4sUUFDdEVPLEVBQU1DLE9BQU9DLElBQVksbUJBQW1CRCxFQUFPQyxPQUNuREQsYUFBa0JFLGVBQ2Isa0JBQWtCRixFQUFPRyxRQUFVLHFCQUN4Q0gsRUFBT0ksWUFBYywwQ0FHbEIsb0JBQW9CSixLQUV0QixtQkFBbUJLLEtBQUtDLFVBQVVQLE1BbUJIUSxDQUFlVCxHQUFPVSxRQUFRLE1BQU8sMENBQ3BFQyxjQUFnQlgsT0FDaEJGLE9BQVMsS0FBT0UsRUFBTUYsYUM3QnpCYyxFQUFZQyxFQUFPQyxvQkFBb0JDLFVBZ0JoQ0MsRUFBU0MsTUFBT0MsRUFBTUMsRUFBa0JDLEVBQVNDLEVBQWlCQyxXQUN2RUMsRUNiZ0IsWUFDaEJBLEVBQVFDLGFBQWFDLFFBQVFaLEVBQU9DLG9CQUFvQlkscUJBRWpELE1BQVRILEdBQWtDLElBQWpCQSxFQUFNSSxhQUNuQixJQUFJbkMsTUFBTW9DLEVBQUtDLEVBQUUsMENBR2xCTixHRE1PTyxnQkFFRCxJQUFJQyxTQUFRLENBQUNDLEVBQVNDLFdBQzNCQyxFQUFVLElBQUk5QixlQUNkK0IsRUFBVSxPQUNOQyxjQUNGcEMsRUFBUSxJQUFJUixNQUFNb0MsRUFBS0MsRUFBRSxrQ0FDekJsQyxLQUFPLHdCQUNNLElBQ1pLLElBR0xvQixLQUNLaUIsaUJBQWlCLFFBQVNGLFdBRTNCRyxJQUFJLGVBQWdCLEdBQUcxQixhQUV2QjJCLEtBQUssT0FBUSxHQUFHM0IsV0FBbUIsS0FFbkNJLE9BQU9xQixpQkFBaUIsWUFBYUcsSUFDdkNyQixLQUNlcUIsRUFBRUMsT0FBU0QsRUFBRUUsWUFJMUJMLGlCQUFpQixTQUFVckMsSUFDN0JvQixLQUNLdUIsb0JBQW9CLFFBQVNSLEtBRS9CLElBQUlTLEVBQWNoQixFQUFLQyxFQUFFLDhCQUErQjdCLFNBR3pEcUMsaUJBQWlCLFFBQVEsUUFDM0JqQixLQUNLdUIsb0JBQW9CLFFBQVNSLEdBR2xDRCxFQUFRN0IsT0FBUyxJQUFLLE9BQ2xCd0MsRUFBV3RDLEtBQUt1QyxNQUFNWixFQUFRYSxnQkFDNUJGLFVBRUQsSUFBSXJELE1BQU1vQyxFQUFLQyxFQUFFLDZCQUE4QixDQUFFbUIsT0FBUWQsRUFBUTVCLHdCQUl0RTJDLEVBQVcsSUFBSUMsU0FDakI1QixLQUNPNkIsSUFBSSxZQUFhN0IsR0FFeEJELEtBQ084QixJQUFJLGlCQUFrQjlCLEtBR3hCOEIsSUFBSSxRQUFTakMsS0FDZGtDLGlCQUFpQixnQkFBaUIsVUFBVTdCLE9BRTVDOEIsS0FBS0oifQ==
