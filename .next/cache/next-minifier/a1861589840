{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{\"+nhR\":function(e,t,n){\"use strict\";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var s=0,o=0,r=[],a=function(){var e=r.pop();return e||(e={position:new THREE.Vector3,velocity:new THREE.Vector3,scale:new THREE.Vector3,quaternion:new THREE.Quaternion,time:0}),e},c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e),this.state=s,this.buffer=[],this.bufferTime=1e3*n,this.time=0,this.mode=t,this.originFrame=a(),this.position=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1)}return i(e,[{key:\"hermite\",value:function(e,t,n,i,s,o){var r=t*t,a=t*t*t,c=2*a-3*r+1,h=-2*a+3*r,d=a-2*r+t,l=a-r;e.copy(n.multiplyScalar(c)),e.add(i.multiplyScalar(h)),e.add(s.multiplyScalar(d)),e.add(o.multiplyScalar(l))}},{key:\"lerp\",value:function(e,t,n,i){e.lerpVectors(t,n,i)}},{key:\"slerp\",value:function(e,t,n,i){THREE.Quaternion.slerp(t,n,e,i)}},{key:\"updateOriginFrameToBufferTail\",value:function(){var e;e=this.originFrame,r.push(e),this.originFrame=this.buffer.shift()}},{key:\"appendBuffer\",value:function(e,t,n,i){var s=this.buffer.length>0?this.buffer[this.buffer.length-1]:null;if(s&&s.time===this.time)e&&s.position.copy(e),t&&s.velocity.copy(t),n&&s.quaternion.copy(n),i&&s.scale.copy(i);else{var o=s||this.originFrame,r=a();r.position.copy(e||o.position),r.velocity.copy(t||o.velocity),r.quaternion.copy(n||o.quaternion),r.scale.copy(i||o.scale),r.time=this.time,this.buffer.push(r)}}},{key:\"setTarget\",value:function(e,t,n,i){this.appendBuffer(e,t,n,i)}},{key:\"setPosition\",value:function(e,t){this.appendBuffer(e,t,null,null)}},{key:\"setQuaternion\",value:function(e){this.appendBuffer(null,null,e,null)}},{key:\"setScale\",value:function(e){this.appendBuffer(null,null,null,e)}},{key:\"update\",value:function(e){if(this.state===s&&this.buffer.length>0&&(this.updateOriginFrameToBufferTail(),this.position.copy(this.originFrame.position),this.quaternion.copy(this.originFrame.quaternion),this.scale.copy(this.originFrame.scale),this.state=1),1===this.state&&this.buffer.length>0&&this.time>this.bufferTime&&(this.state=2),2===this.state){for(var t=this.time-this.bufferTime;this.buffer.length>0&&t>this.buffer[0].time;)this.buffer.length>1?this.updateOriginFrameToBufferTail():(this.originFrame.position.copy(this.buffer[0].position),this.originFrame.velocity.copy(this.buffer[0].velocity),this.originFrame.quaternion.copy(this.buffer[0].quaternion),this.originFrame.scale.copy(this.buffer[0].scale),this.originFrame.time=this.buffer[0].time,this.buffer[0].time=this.time+e);if(this.buffer.length>0&&this.buffer[0].time>0){var n=this.buffer[0],i=n.time-this.originFrame.time,r=(t-this.originFrame.time)/i;this.mode===o?this.lerp(this.position,this.originFrame.position,n.position,r):1===this.mode&&this.hermite(this.position,r,this.originFrame.position,n.position,this.originFrame.velocity.multiplyScalar(i),n.velocity.multiplyScalar(i)),this.slerp(this.quaternion,this.originFrame.quaternion,n.quaternion,r),this.lerp(this.scale,this.originFrame.scale,n.scale,r)}}this.state!==s&&(this.time+=e)}},{key:\"getPosition\",value:function(){return this.position}},{key:\"getQuaternion\",value:function(){return this.quaternion}},{key:\"getScale\",value:function(){return this.scale}}]),e}();e.exports=c},BARu:function(e,t){class n{constructor(e,t,n){this.localId=e,this.remoteId=t,this.sendSignalFunc=n,this.open=!1,this.channelLabel=\"networked-aframe-channel\",this.pc=this.createPeerConnection(),this.channel=null}setDatachannelListeners(e,t,n,i){this.openListener=e,this.closedListener=t,this.messageListener=n,this.trackListener=i}offer(e){var t=this;this.setupChannel(this.pc.createDataChannel(this.channelLabel,{reliable:!1})),e.sendAudio&&e.localAudioStream.getTracks().forEach(n=>t.pc.addTrack(n,e.localAudioStream)),this.pc.createOffer(e=>{t.handleSessionDescription(e)},e=>{NAF.log.error(\"WebRtcPeer.offer: \"+e)},{offerToReceiveAudio:!0,offerToReceiveVideo:!1})}handleSignal(e){if(this.localId===e.to&&this.remoteId===e.from)switch(e.type){case\"offer\":this.handleOffer(e);break;case\"answer\":this.handleAnswer(e);break;case\"candidate\":this.handleCandidate(e);break;default:NAF.log.error(\"WebRtcPeer.handleSignal: Unknown signal type \"+e.type)}}send(e,t){null!==this.channel&&\"open\"===this.channel.readyState&&this.channel.send(JSON.stringify({type:e,data:t}))}getStatus(){if(null===this.channel)return n.NOT_CONNECTED;switch(this.channel.readyState){case\"open\":return n.IS_CONNECTED;case\"connecting\":return n.CONNECTING;case\"closing\":case\"closed\":default:return n.NOT_CONNECTED}}createPeerConnection(){var e=this,t=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection;if(void 0===t)throw new Error(\"WebRtcPeer.createPeerConnection: This browser does not seem to support WebRTC.\");var i=new t({iceServers:n.ICE_SERVERS});return i.onicecandidate=function(t){t.candidate&&e.sendSignalFunc({from:e.localId,to:e.remoteId,type:\"candidate\",sdpMLineIndex:t.candidate.sdpMLineIndex,candidate:t.candidate.candidate})},i.oniceconnectionstatechange=function(){e.open&&\"disconnected\"===i.iceConnectionState&&(e.open=!1,e.closedListener(e.remoteId))},i.ontrack=t=>{e.trackListener(e.remoteId,t.streams[0])},i}setupChannel(e){var t=this;this.channel=e,this.channel.onmessage=function(e){var n=JSON.parse(e.data);t.messageListener(t.remoteId,n.type,n.data)},this.channel.onopen=function(e){t.open=!0,t.openListener(t.remoteId)},this.channel.onclose=function(e){t.open&&(t.open=!1,t.closedListener(t.remoteId))},this.channel.onerror=function(e){NAF.log.error(\"WebRtcPeer.channel.onerror: \"+e)}}handleOffer(e){var t=this;this.pc.ondatachannel=function(e){t.setupChannel(e.channel)},this.setRemoteDescription(e),this.pc.createAnswer((function(e){t.handleSessionDescription(e)}),(function(e){NAF.log.error(\"WebRtcPeer.handleOffer: \"+e)}))}handleAnswer(e){this.setRemoteDescription(e)}handleCandidate(e){var t=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate;this.pc.addIceCandidate(new t(e),(function(){}),(function(e){NAF.log.error(\"WebRtcPeer.handleCandidate: \"+e)}))}handleSessionDescription(e){this.pc.setLocalDescription(e,(function(){}),(function(e){NAF.log.error(\"WebRtcPeer.handleSessionDescription: \"+e)})),this.sendSignalFunc({from:this.localId,to:this.remoteId,type:e.type,sdp:e.sdp})}setRemoteDescription(e){var t=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription||window.msRTCSessionDescription;this.pc.setRemoteDescription(new t(e),(function(){}),(function(e){NAF.log.error(\"WebRtcPeer.setRemoteDescription: \"+e)}))}close(){this.pc&&this.pc.close()}}n.IS_CONNECTED=\"IS_CONNECTED\",n.CONNECTING=\"CONNECTING\",n.NOT_CONNECTED=\"NOT_CONNECTED\",n.ICE_SERVERS=[{urls:\"stun:stun1.l.google.com:19302\"},{urls:\"stun:stun2.l.google.com:19302\"},{urls:\"stun:stun3.l.google.com:19302\"},{urls:\"stun:stun4.l.google.com:19302\"}];e.exports=class{constructor(){void 0===io&&console.warn(\"It looks like socket.io has not been loaded before WebrtcAdapter. Please do that.\"),this.app=\"default\",this.room=\"default\",this.occupantListener=null,this.myRoomJoinTime=null,this.myId=null,this.peers={},this.occupants={},this.audioStreams={},this.pendingAudioRequest={},this.serverTimeRequests=0,this.timeOffsets=[],this.avgTimeOffset=0}setServerUrl(e){this.wsUrl=e}setApp(e){this.app=e}setRoom(e){this.room=e}setWebRtcOptions(e){!1===e.datachannel&&NAF.log.error(\"WebrtcAdapter.setWebRtcOptions: datachannel must be true.\"),!0===e.audio&&(this.sendAudio=!0),!0===e.video&&NAF.log.warn(\"WebrtcAdapter does not support video yet.\")}setServerConnectListeners(e,t){this.connectSuccess=e,this.connectFailure=t}setRoomOccupantListener(e){this.occupantListener=e}setDataChannelListeners(e,t,n){this.openListener=e,this.closedListener=t,this.messageListener=n}connect(){const e=this;this.updateTimeOffset().then(()=>{e.wsUrl&&\"/\"!==e.wsUrl||(\"https:\"===location.protocol?e.wsUrl=\"wss://\"+location.host:e.wsUrl=\"ws://\"+location.host),NAF.log.write(\"Attempting to connect to socket.io\");const t=e.socket=io(e.wsUrl);function n(t){const n=t.from,i=t.type,s=t.data;\"ice-candidate\"!==i?e.messageListener(n,i,s):e.peers[n].handleSignal(s)}t.on(\"connect\",()=>{NAF.log.write(\"User connected\",t.id),e.myId=t.id,e.joinRoom()}),t.on(\"connectSuccess\",t=>{const{joinedTime:n}=t;if(e.myRoomJoinTime=n,NAF.log.write(\"Successfully joined room\",e.room,\"at server time\",n),e.sendAudio){const t={audio:!0,video:!1};navigator.mediaDevices.getUserMedia(t).then(t=>{e.storeAudioStream(e.myId,t),e.connectSuccess(e.myId)}).catch(e=>NAF.log.error(e))}else e.connectSuccess(e.myId)}),t.on(\"error\",t=>{console.error(\"Socket connection failure\",t),e.connectFailure()}),t.on(\"occupantsChanged\",t=>{const{occupants:n}=t;NAF.log.write(\"occupants changed\",t),e.receivedOccupants(n)}),t.on(\"send\",n),t.on(\"broadcast\",n)})}joinRoom(){NAF.log.write(\"Joining room\",this.room),this.socket.emit(\"joinRoom\",{room:this.room})}receivedOccupants(e){delete e[this.myId],this.occupants=e;const t=this,i=this.myId;for(var s in e){const e=s;if(this.peers[e])continue;const o=new n(i,e,n=>{t.socket.emit(\"send\",{from:i,to:e,type:\"ice-candidate\",data:n,sending:!0})});o.setDatachannelListeners(t.openListener,t.closedListener,t.messageListener,t.trackListener.bind(t)),t.peers[e]=o}this.occupantListener(e)}shouldStartConnectionTo(e){return(this.myRoomJoinTime||0)<=(e||0)}startStreamConnection(e){NAF.log.write(\"starting offer process\"),this.sendAudio?this.getMediaStream(this.myId).then(t=>{const n={sendAudio:!0,localAudioStream:t};this.peers[e].offer(n)}):this.peers[e].offer({})}closeStreamConnection(e){NAF.log.write(\"closeStreamConnection\",e,this.peers),this.peers[e].close(),delete this.peers[e],delete this.occupants[e],this.closedListener(e)}getConnectStatus(e){const t=this.peers[e];if(void 0===t)return NAF.adapters.NOT_CONNECTED;switch(t.getStatus()){case n.IS_CONNECTED:return NAF.adapters.IS_CONNECTED;case n.CONNECTING:return NAF.adapters.CONNECTING;case n.NOT_CONNECTED:default:return NAF.adapters.NOT_CONNECTED}}sendData(e,t,n){this.peers[e].send(t,n)}sendDataGuaranteed(e,t,n){const i={from:this.myId,to:e,type:t,data:n,sending:!0};this.socket.emit(\"send\",i)}broadcastData(e,t){for(var n in this.peers)this.sendData(n,e,t)}broadcastDataGuaranteed(e,t){const n={from:this.myId,type:e,data:t,broadcasting:!0};this.socket.emit(\"broadcast\",n)}storeAudioStream(e,t){this.audioStreams[e]=t,this.pendingAudioRequest[e]&&(NAF.log.write(\"Received pending audio for \"+e),this.pendingAudioRequest[e](t),this.pendingAudioRequest[e](t))}trackListener(e,t){this.storeAudioStream(e,t)}getMediaStream(e){var t=this;return this.audioStreams[e]?(NAF.log.write(\"Already had audio for \"+e),Promise.resolve(this.audioStreams[e])):(NAF.log.write(\"Waiting on audio for \"+e),new Promise(n=>{t.pendingAudioRequest[e]=n}))}updateTimeOffset(){const e=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:\"HEAD\",cache:\"no-cache\"}).then(t=>{var n=new Date(t.headers.get(\"Date\")).getTime()+500,i=Date.now(),s=n+(i-e)/2-i;this.serverTimeRequests++,this.serverTimeRequests<=10?this.timeOffsets.push(s):this.timeOffsets[this.serverTimeRequests%10]=s,this.avgTimeOffset=this.timeOffsets.reduce((e,t)=>e+=t,0)/this.timeOffsets.length,this.serverTimeRequests>10?setTimeout(()=>this.updateTimeOffset(),3e5):this.updateTimeOffset()})}getServerTime(){return new Date+this.avgTimeOffset}}},EYIQ:function(e,t,n){var i=n(\"tvSW\"),s=n(\"iBZa\"),o=n(\"mqsc\"),r=n(\"umSQ\"),a=n(\"G4PH\"),c=n(\"Pozc\"),h=n(\"V8Jh\"),d={app:\"\",room:\"\",clientId:\"\"};d.options=i,d.utils=s,d.log=new o,d.schemas=new r,d.version=\"0.6.1\",d.adapters=new h;var l=new a,u=new c(l);d.connection=u,d.entities=l,e.exports=window.NAF=d},FJvS:function(e,t){AFRAME.registerComponent(\"networked-scene\",{schema:{serverURL:{default:\"/\"},app:{default:\"default\"},room:{default:\"default\"},connectOnLoad:{default:!0},onConnect:{default:\"onConnect\"},adapter:{default:\"socketio\"},audio:{default:!1},debug:{default:!1}},init:function(){var e=this.el;this.connect=this.connect.bind(this),e.addEventListener(\"connect\",this.connect),this.data.connectOnLoad&&e.emit(\"connect\",null,!1)},connect:function(){return NAF.log.setDebug(this.data.debug),NAF.log.write(\"Networked-Aframe Connecting...\"),this.checkDeprecatedProperties(),this.setupNetworkAdapter(),this.hasOnConnectFunction()&&this.callOnConnect(),NAF.connection.connect(this.data.serverURL,this.data.app,this.data.room,this.data.audio)},checkDeprecatedProperties:function(){},setupNetworkAdapter:function(){var e=this.data.adapter,t=NAF.adapters.make(e);NAF.connection.setNetworkAdapter(t),this.el.emit(\"adapter-ready\",t,!1)},hasOnConnectFunction:function(){return\"\"!=this.data.onConnect&&window[this.data.onConnect]},callOnConnect:function(){NAF.connection.onConnect(window[this.data.onConnect])},remove:function(){NAF.log.write(\"networked-scene disconnected\"),this.el.removeEventListener(\"connect\",this.connect),NAF.connection.disconnect()}})},G4PH:function(e,t,n){var i=n(\"ozXo\");e.exports=class{constructor(){this.entities={},this.childCache=new i,this.onRemoteEntityCreatedEvent=new Event(\"remoteEntityCreated\"),this._persistentFirstSyncs={}}registerEntity(e,t){this.entities[e]=t}createRemoteEntity(e){NAF.log.write(\"Creating remote entity\",e);var t=e.networkId,n=NAF.schemas.getCachedTemplate(e.template);return n.setAttribute(\"id\",\"naf-\"+t),this.initPosition(n,e.components),this.initRotation(n,e.components),this.addNetworkComponent(n,e),this.registerEntity(t,n),n}initPosition(e,t){if(t.position){var n=t.position;e.setAttribute(\"position\",n)}}initRotation(e,t){if(t.rotation){var n=t.rotation;e.setAttribute(\"rotation\",n)}}addNetworkComponent(e,t){var n={template:t.template,creator:t.creator,owner:t.owner,networkId:t.networkId,persistent:t.persistent};e.setAttribute(\"networked\",n),e.firstUpdateData=t}updateEntityMulti(e,t,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource)for(let s=0,o=n.d.length;s<o;s++)this.updateEntity(e,\"u\",n.d[s],i)}updateEntity(e,t,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource){var s=n.networkId;this.hasEntity(s)?this.entities[s].components.networked.networkUpdate(n):n.isFirstSync&&(NAF.options.firstSyncSource&&i!==NAF.options.firstSyncSource?NAF.log.write(\"Ignoring first sync from disallowed source\",i):n.persistent?this._persistentFirstSyncs[s]=n:this.receiveFirstUpdateFromEntity(n))}}receiveFirstUpdateFromEntity(e){var t=e.parent,n=e.networkId;if(t&&!this.hasEntity(t))this.childCache.addChild(t,e);else{var i=this.createRemoteEntity(e);this.createAndAppendChildren(n,i),this.addEntityToPage(i,t)}}createAndAppendChildren(e,t){for(var n=this.childCache.getChildren(e),i=0;i<n.length;i++){var s=n[i],o=s.networkId;if(this.hasEntity(o))NAF.log.warn(\"Tried to instantiate entity multiple times\",o,s,\"Existing entity:\",this.getEntity(o));else{var r=this.createRemoteEntity(s);this.createAndAppendChildren(o,r),t.appendChild(r)}}}addEntityToPage(e,t){this.hasEntity(t)?this.addEntityToParent(e,t):this.addEntityToSceneRoot(e)}addEntityToParent(e,t){document.getElementById(\"naf-\"+t).appendChild(e)}addEntityToSceneRoot(e){document.querySelector(\"a-scene\").appendChild(e)}completeSync(e,t){for(var n in this.entities)this.entities[n]&&this.entities[n].components.networked.syncAll(e,t)}removeRemoteEntity(e,t,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource){var s=n.networkId;return this.removeEntity(s)}}removeEntitiesOfClient(e){var t=[];for(var n in this.entities){if(NAF.utils.getCreator(this.entities[n])===e){let e;const s=this.entities[n].getAttribute(\"networked\");if(s&&s.persistent&&(e=NAF.utils.takeOwnership(this.entities[n])),!e){var i=this.removeEntity(n);t.push(i)}}}return t}removeEntity(e){if(this.forgetPersistentFirstSync(e),this.hasEntity(e)){var t=this.entities[e];return this.forgetEntity(e),t.parentNode.removeChild(t),t}return NAF.log.error(\"Tried to remove entity I don't have.\"),null}forgetEntity(e){delete this.entities[e],this.forgetPersistentFirstSync(e)}getPersistentFirstSync(e){return this._persistentFirstSyncs[e]}forgetPersistentFirstSync(e){delete this._persistentFirstSyncs[e]}getEntity(e){return this.entities[e]?this.entities[e]:null}hasEntity(e){return!!this.entities[e]}removeRemoteEntities(){for(var e in this.childCache=new i,this.entities){this.entities[e].getAttribute(\"networked\").owner!=NAF.clientId&&this.removeEntity(e)}}}},Pozc:function(e,t){var n={Update:\"u\",UpdateMulti:\"um\",Remove:\"r\"};e.exports=class{constructor(e){this.entities=e,this.setupDefaultDataSubscriptions(),this.connectedClients={},this.activeDataChannels={}}setNetworkAdapter(e){this.adapter=e}setupDefaultDataSubscriptions(){this.dataChannelSubs={},this.dataChannelSubs[n.Update]=this.entities.updateEntity.bind(this.entities),this.dataChannelSubs[n.UpdateMulti]=this.entities.updateEntityMulti.bind(this.entities),this.dataChannelSubs[n.Remove]=this.entities.removeRemoteEntity.bind(this.entities)}connect(e,t,n,i=!1){NAF.app=t,NAF.room=n,this.adapter.setServerUrl(e),this.adapter.setApp(t),this.adapter.setRoom(n);var s={audio:i,video:!1,datachannel:!0};return this.adapter.setWebRtcOptions(s),this.adapter.setServerConnectListeners(this.connectSuccess.bind(this),this.connectFailure.bind(this)),this.adapter.setDataChannelListeners(this.dataChannelOpen.bind(this),this.dataChannelClosed.bind(this),this.receivedData.bind(this)),this.adapter.setRoomOccupantListener(this.occupantsReceived.bind(this)),this.adapter.connect()}onConnect(e){this.onConnectCallback=e,this.isConnected()?e():document.body.addEventListener(\"connected\",e,!1)}connectSuccess(e){NAF.log.write(\"Networked-Aframe Client ID:\",e),NAF.clientId=e;var t=new CustomEvent(\"connected\",{detail:{clientId:e}});document.body.dispatchEvent(t)}connectFailure(e,t){NAF.log.error(e,\"failure to connect\")}occupantsReceived(e){var t=Object.assign({},this.connectedClients);this.connectedClients=e,this.checkForDisconnectingClients(t,e),this.checkForConnectingClients(e)}checkForDisconnectingClients(e,t){for(var n in e){t[n]||(NAF.log.write(\"Closing stream to \",n),this.adapter.closeStreamConnection(n))}}checkForConnectingClients(e){for(var t in e){this.isNewClient(t)&&this.adapter.shouldStartConnectionTo(e[t])&&(NAF.log.write(\"Opening datachannel to \",t),this.adapter.startStreamConnection(t))}}getConnectedClients(){return this.connectedClients}isConnected(){return!!NAF.clientId}isMineAndConnected(e){return this.isConnected()&&NAF.clientId===e}isNewClient(e){return!this.isConnectedTo(e)}isConnectedTo(e){return this.adapter.getConnectStatus(e)===NAF.adapters.IS_CONNECTED}dataChannelOpen(e){NAF.log.write(\"Opened data channel from \"+e),this.activeDataChannels[e]=!0,this.entities.completeSync(e,!0);var t=new CustomEvent(\"clientConnected\",{detail:{clientId:e}});document.body.dispatchEvent(t)}dataChannelClosed(e){NAF.log.write(\"Closed data channel from \"+e),this.activeDataChannels[e]=!1,this.entities.removeEntitiesOfClient(e);var t=new CustomEvent(\"clientDisconnected\",{detail:{clientId:e}});document.body.dispatchEvent(t)}hasActiveDataChannel(e){return!(!this.activeDataChannels[e]||!this.activeDataChannels[e])}broadcastData(e,t){this.adapter.broadcastData(e,t)}broadcastDataGuaranteed(e,t){this.adapter.broadcastDataGuaranteed(e,t)}sendData(e,t,n,i){this.hasActiveDataChannel(e)&&(i?this.adapter.sendDataGuaranteed(e,t,n):this.adapter.sendData(e,t,n))}sendDataGuaranteed(e,t,n){this.sendData(e,t,n,!0)}subscribeToDataChannel(e,t){this.isReservedDataType(e)?NAF.log.error(\"NetworkConnection@subscribeToDataChannel: \"+e+\" is a reserved dataType. Choose another\"):this.dataChannelSubs[e]=t}unsubscribeToDataChannel(e){this.isReservedDataType(e)?NAF.log.error(\"NetworkConnection@unsubscribeToDataChannel: \"+e+\" is a reserved dataType. Choose another\"):delete this.dataChannelSubs[e]}isReservedDataType(e){return e==n.Update||e==n.Remove}receivedData(e,t,n,i){this.dataChannelSubs[t]?this.dataChannelSubs[t](e,t,n,i):NAF.log.write(\"NetworkConnection@receivedData: \"+t+\" has not been subscribed to yet. Call subscribeToDataChannel()\")}getServerTime(){return this.adapter.getServerTime()}disconnect(){this.entities.removeRemoteEntities(),this.adapter.disconnect(),NAF.app=\"\",NAF.room=\"\",NAF.clientId=\"\",this.connectedClients={},this.activeDataChannels={},this.adapter=null,this.setupDefaultDataSubscriptions(),document.body.removeEventListener(\"connected\",this.onConnectCallback)}}},V8Jh:function(e,t,n){const i=n(\"BARu\"),s=n(\"jF9T\");class o{constructor(){this.adapters={socketio:s,webrtc:i},this.IS_CONNECTED=o.IS_CONNECTED,this.CONNECTING=o.CONNECTING,this.NOT_CONNECTED=o.NOT_CONNECTED}register(e,t){this.adapters[e]=t}make(e){var t=e.toLowerCase();if(this.adapters[t])return new(0,this.adapters[t]);throw\"easyrtc\"===t||\"wseasyrtc\"==t?new Error(\"Adapter: \"+e+\" not registered. EasyRTC support was removed in Networked-Aframe 0.7.0. To use the deprecated EasyRTC adapter see https://github.com/networked-aframe/naf-easyrtc-adapter\"):new Error(\"Adapter: \"+e+\" not registered. Please use NAF.adapters.register() to register this adapter.\")}}o.IS_CONNECTED=\"IS_CONNECTED\",o.CONNECTING=\"CONNECTING\",o.NOT_CONNECTED=\"NOT_CONNECTED\",e.exports=o},WeY7:function(e,t,n){n(\"EYIQ\"),n(\"FJvS\"),n(\"xK6/\"),n(\"mxTd\")},iBZa:function(e,t){e.exports.whenEntityLoaded=function(e,t){e.hasLoaded&&t(),e.addEventListener(\"loaded\",(function(){t()}))},e.exports.createHtmlNodeFromString=function(e){var t=document.createElement(\"div\");return t.innerHTML=e,t.firstChild},e.exports.getCreator=function(e){var t=e.components;return t.networked?t.networked.data.creator:null},e.exports.getNetworkOwner=function(e){var t=e.components;return t.networked?t.networked.data.owner:null},e.exports.getNetworkId=function(e){var t=e.components;return t.networked?t.networked.data.networkId:null},e.exports.now=function(){return Date.now()},e.exports.createNetworkId=function(){return Math.random().toString(36).substring(2,9)},e.exports.getNetworkedEntity=function(e){return new Promise((t,n)=>{let i=e;for(;i&&i.components&&!i.components.networked;)i=i.parentNode;if(!i||!i.components||!i.components.networked)return n(\"Entity does not have and is not a child of an entity with the [networked] component \");i.hasLoaded?t(i):i.addEventListener(\"instantiated\",()=>{t(i)},{once:!0})})},e.exports.takeOwnership=function(e){let t=e;for(;t&&t.components&&!t.components.networked;)t=t.parentNode;if(!t||!t.components||!t.components.networked)throw new Error(\"Entity does not have and is not a child of an entity with the [networked] component \");return t.components.networked.takeOwnership()},e.exports.isMine=function(e){let t=e;for(;t&&t.components&&!t.components.networked;)t=t.parentNode;if(!t||!t.components||!t.components.networked)throw new Error(\"Entity does not have and is not a child of an entity with the [networked] component \");return t.components.networked.data.owner===NAF.clientId},e.exports.almostEqualVec3=function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n}},jF9T:function(e,t){e.exports=class{constructor(){void 0===io&&console.warn(\"It looks like socket.io has not been loaded before SocketioAdapter. Please do that.\"),this.app=\"default\",this.room=\"default\",this.occupantListener=null,this.myRoomJoinTime=null,this.myId=null,this.occupants={},this.connectedClients=[],this.serverTimeRequests=0,this.timeOffsets=[],this.avgTimeOffset=0}setServerUrl(e){this.wsUrl=e}setApp(e){this.app=e}setRoom(e){this.room=e}setWebRtcOptions(e){}setServerConnectListeners(e,t){this.connectSuccess=e,this.connectFailure=t}setRoomOccupantListener(e){this.occupantListener=e}setDataChannelListeners(e,t,n){this.openListener=e,this.closedListener=t,this.messageListener=n}connect(){const e=this;this.updateTimeOffset().then(()=>{e.wsUrl&&\"/\"!==e.wsUrl||(\"https:\"===location.protocol?e.wsUrl=\"wss://\"+location.host:e.wsUrl=\"ws://\"+location.host),NAF.log.write(\"Attempting to connect to socket.io\");const t=e.socket=io(e.wsUrl);function n(t){const n=t.from,i=t.type,s=t.data;e.messageListener(n,i,s)}t.on(\"connect\",()=>{NAF.log.write(\"User connected\",t.id),e.myId=t.id,e.joinRoom()}),t.on(\"connectSuccess\",t=>{const{joinedTime:n}=t;e.myRoomJoinTime=n,NAF.log.write(\"Successfully joined room\",e.room,\"at server time\",n),e.connectSuccess(e.myId)}),t.on(\"error\",t=>{console.error(\"Socket connection failure\",t),e.connectFailure()}),t.on(\"occupantsChanged\",t=>{const{occupants:n}=t;NAF.log.write(\"occupants changed\",t),e.receivedOccupants(n)}),t.on(\"send\",n),t.on(\"broadcast\",n)})}joinRoom(){NAF.log.write(\"Joining room\",this.room),this.socket.emit(\"joinRoom\",{room:this.room})}receivedOccupants(e){delete e[this.myId],this.occupants=e,this.occupantListener(e)}shouldStartConnectionTo(e){return!0}startStreamConnection(e){this.connectedClients.push(e),this.openListener(e)}closeStreamConnection(e){this.connectedClients=this.connectedClients.filter(t=>t!=e),this.closedListener(e)}getConnectStatus(e){return-1!=this.connectedClients.indexOf(e)?NAF.adapters.IS_CONNECTED:NAF.adapters.NOT_CONNECTED}sendData(e,t,n){this.sendDataGuaranteed(e,t,n)}sendDataGuaranteed(e,t,n){const i={from:this.myId,to:e,type:t,data:n,sending:!0};this.socket?this.socket.emit(\"send\",i):NAF.log.warn(\"SocketIO socket not created yet\")}broadcastData(e,t){this.broadcastDataGuaranteed(e,t)}broadcastDataGuaranteed(e,t){const n={from:this.myId,type:e,data:t,broadcasting:!0};this.socket?this.socket.emit(\"broadcast\",n):NAF.log.warn(\"SocketIO socket not created yet\")}getMediaStream(e){}updateTimeOffset(){const e=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:\"HEAD\",cache:\"no-cache\"}).then(t=>{var n=new Date(t.headers.get(\"Date\")).getTime()+500,i=Date.now(),s=n+(i-e)/2-i;this.serverTimeRequests++,this.serverTimeRequests<=10?this.timeOffsets.push(s):this.timeOffsets[this.serverTimeRequests%10]=s,this.avgTimeOffset=this.timeOffsets.reduce((e,t)=>e+=t,0)/this.timeOffsets.length,this.serverTimeRequests>10?setTimeout(()=>this.updateTimeOffset(),3e5):this.updateTimeOffset()})}getServerTime(){return new Date+this.avgTimeOffset}}},mqsc:function(e,t){e.exports=class{constructor(){this.debug=!1}setDebug(e){this.debug=e}write(){this.debug&&console.log.apply(this,arguments)}warn(){console.warn.apply(this,arguments)}error(){console.error.apply(this,arguments)}}},mxTd:function(e,t,n){var i=n(\"EYIQ\");AFRAME.registerComponent(\"networked-audio-source\",{schema:{positional:{default:!0},distanceModel:{default:\"inverse\",oneOf:[\"linear\",\"inverse\",\"exponential\"]},maxDistance:{default:1e4},refDistance:{default:1},rolloffFactor:{default:1}},init:function(){this.listener=null,this.stream=null,this._setMediaStream=this._setMediaStream.bind(this),NAF.utils.getNetworkedEntity(this.el).then(e=>{const t=e.components.networked.data.owner;t&&NAF.connection.adapter.getMediaStream(t).then(this._setMediaStream).catch(e=>i.log.error(`Error getting media stream for ${t}`,e))})},update(){this._setPannerProperties()},_setMediaStream(e){if(this.sound||this.setupSound(),e!=this.stream){if(this.stream&&this.sound.disconnect(),e){/chrome/i.test(navigator.userAgent)&&(this.audioEl=new Audio,this.audioEl.setAttribute(\"autoplay\",\"autoplay\"),this.audioEl.setAttribute(\"playsinline\",\"playsinline\"),this.audioEl.srcObject=e,this.audioEl.volume=0);const t=this.sound.context.createMediaStreamSource(e);this.sound.setNodeSource(t),this.el.emit(\"sound-source-set\",{soundSource:t})}this.stream=e}},_setPannerProperties(){this.sound&&this.data.positional&&(this.sound.setDistanceModel(this.data.distanceModel),this.sound.setMaxDistance(this.data.maxDistance),this.sound.setRefDistance(this.data.refDistance),this.sound.setRolloffFactor(this.data.rolloffFactor))},remove:function(){this.sound&&(this.el.removeObject3D(this.attrName),this.stream&&this.sound.disconnect())},setupSound:function(){var e=this.el,t=e.sceneEl;this.sound&&e.removeObject3D(this.attrName),t.audioListener||(t.audioListener=new THREE.AudioListener,t.camera&&t.camera.add(t.audioListener),t.addEventListener(\"camera-set-active\",(function(e){e.detail.cameraEl.getObject3D(\"camera\").add(t.audioListener)}))),this.listener=t.audioListener,this.sound=this.data.positional?new THREE.PositionalAudio(this.listener):new THREE.Audio(this.listener),e.setObject3D(this.attrName,this.sound),this._setPannerProperties()}})},ozXo:function(e,t){e.exports=class{constructor(){this.dict={}}addChild(e,t){this.hasParent(e)||(this.dict[e]=[]),this.dict[e].push(t)}getChildren(e){if(!this.hasParent(e))return[];var t=this.dict[e];return delete this.dict[e],t}hasParent(e){return!!this.dict[e]}}},tvSW:function(e,t){e.exports={debug:!1,updateRate:15,useLerp:!0,firstSyncSource:null,syncSource:null}},umSQ:function(e,t){e.exports=class{constructor(){this.schemaDict={},this.templateCache={}}createDefaultSchema(e){return{template:e,components:[\"position\",\"rotation\"]}}add(e){if(this.validateSchema(e)){this.schemaDict[e.template]=e;var t=document.querySelector(e.template);if(!t)return void NAF.log.error(`Template el not found for ${e.template}, make sure NAF.schemas.add is called after <a-scene> is defined.`);if(!this.validateTemplate(e,t))return;this.templateCache[e.template]=document.importNode(t.content,!0)}else NAF.log.error(\"Schema not valid: \",e),NAF.log.error(\"See https://github.com/haydenjameslee/networked-aframe#syncing-custom-components\")}getCachedTemplate(e){return this.templateIsCached(e)||(this.templateExistsInScene(e)?this.add(this.createDefaultSchema(e)):NAF.log.error(`Template el for ${e} is not in the scene, add the template to <a-assets> and register with NAF.schemas.add.`)),this.templateCache[e].firstElementChild.cloneNode(!0)}templateIsCached(e){return!!this.templateCache[e]}getComponents(e){var t=[\"position\",\"rotation\"];return this.hasTemplate(e)&&(t=this.schemaDict[e].components),t}hasTemplate(e){return!!this.schemaDict[e]}templateExistsInScene(e){var t=document.querySelector(e);return t&&this.isTemplateTag(t)}validateSchema(e){return!(!e.template||!e.components)}validateTemplate(e,t){return this.isTemplateTag(t)?!!this.templateHasOneOrZeroChildren(t)||(NAF.log.error(`Template for ${e.template} has more than one child. Templates must have one direct child element, no more. Template found:`,t),!1):(NAF.log.error(`Template for ${e.template} is not a <template> tag. Instead found: ${t.tagName}`),!1)}isTemplateTag(e){return\"template\"===e.tagName.toLowerCase()}templateHasOneOrZeroChildren(e){return e.content.childElementCount<2}remove(e){delete this.schemaDict[e]}clear(){this.schemaDict={}}}},\"xK6/\":function(e,t,n){var i=n(\"zs+I\"),s=n(\"+nhR\"),o=THREE.Math.DEG2RAD,r=[\"position\",\"rotation\",\"scale\"];AFRAME.registerSystem(\"networked\",{init(){this.components=[],this.nextSyncTime=0},register(e){this.components.push(e)},deregister(e){const t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)},tick:function(){if(!NAF.connection.adapter)return;if(this.el.clock.elapsedTime<this.nextSyncTime)return;const e={d:[]};for(let t=0,n=this.components.length;t<n;t++){const n=this.components[t];if(!n.isMine())continue;if(!n.el.parentElement)return void NAF.log.error(\"entity registered with system despite being removed\");const i=this.components[t].syncDirty();i&&e.d.push(i)}e.d.length>0&&NAF.connection.broadcastData(\"um\",e),this.updateNextSyncTime()},updateNextSyncTime(){this.nextSyncTime=this.el.clock.elapsedTime+1/NAF.options.updateRate}}),AFRAME.registerComponent(\"networked\",{schema:{template:{default:\"\"},attachTemplateToLocal:{default:!0},persistent:{default:!1},networkId:{default:\"\"},owner:{default:\"\"},creator:{default:\"\"}},init:function(){this.OWNERSHIP_GAINED=\"ownership-gained\",this.OWNERSHIP_CHANGED=\"ownership-changed\",this.OWNERSHIP_LOST=\"ownership-lost\",this.onOwnershipGainedEvent={el:this.el},this.onOwnershipChangedEvent={el:this.el},this.onOwnershipLostEvent={el:this.el},this.conversionEuler=new THREE.Euler,this.conversionEuler.order=\"YXZ\",this.bufferInfos=[],this.bufferPosition=new THREE.Vector3,this.bufferQuaternion=new THREE.Quaternion,this.bufferScale=new THREE.Vector3;var e=this.wasCreatedByNetwork();this.onConnected=this.onConnected.bind(this),this.syncData={},this.componentSchemas=NAF.schemas.getComponents(this.data.template),this.cachedElements=new Array(this.componentSchemas.length),this.networkUpdatePredicates=this.componentSchemas.map(e=>e.requiresNetworkUpdate&&e.requiresNetworkUpdate()||function(){let e=null;return t=>(null===e||!i(e,t))&&(e=AFRAME.utils.clone(t),!0)}()),this.invalidateCachedElements(),this.initNetworkParent(),\"\"===this.data.networkId&&this.el.setAttribute(this.name,{networkId:NAF.utils.createNetworkId()}),e?this.firstUpdate():(this.data.attachTemplateToLocal&&this.attachTemplateToLocal(),this.registerEntity(this.data.networkId)),this.lastOwnerTime=-1,NAF.clientId?this.onConnected():document.body.addEventListener(\"connected\",this.onConnected,!1),document.body.dispatchEvent(this.entityCreatedEvent()),this.el.dispatchEvent(new CustomEvent(\"instantiated\",{detail:{el:this.el}})),this.el.sceneEl.systems.networked.register(this)},attachTemplateToLocal:function(){const e=NAF.schemas.getCachedTemplate(this.data.template),t=e.attributes;for(let n=0;n<t.length;n++)this.el.setAttribute(t[n].name,t[n].value);for(;e.firstElementChild;)this.el.appendChild(e.firstElementChild)},takeOwnership:function(){const e=this.data.owner,t=this.lastOwnerTime,n=NAF.connection.getServerTime();return!!(e&&!this.isMine()&&t<n)&&(this.lastOwnerTime=n,this.removeLerp(),this.el.setAttribute(\"networked\",{owner:NAF.clientId}),this.syncAll(),this.onOwnershipGainedEvent.oldOwner=e,this.el.emit(this.OWNERSHIP_GAINED,this.onOwnershipGainedEvent),this.onOwnershipChangedEvent.oldOwner=e,this.onOwnershipChangedEvent.newOwner=NAF.clientId,this.el.emit(this.OWNERSHIP_CHANGED,this.onOwnershipChangedEvent),!0)},wasCreatedByNetwork:function(){return!!this.el.firstUpdateData},initNetworkParent:function(){var e=this.el.parentElement;e.components&&e.components.networked?this.parent=e:this.parent=null},registerEntity:function(e){NAF.entities.registerEntity(e,this.el)},applyPersistentFirstSync:function(){const{networkId:e}=this.data,t=NAF.entities.getPersistentFirstSync(e);t&&(this.networkUpdate(t),NAF.entities.forgetPersistentFirstSync(e))},firstUpdate:function(){var e=this.el.firstUpdateData;this.networkUpdate(e)},onConnected:function(){\"\"===this.data.owner&&(this.lastOwnerTime=NAF.connection.getServerTime(),this.el.setAttribute(this.name,{owner:NAF.clientId,creator:NAF.clientId}),setTimeout(()=>{this.el.parentNode?this.syncAll(void 0,!0):NAF.log.warn(\"Networked element was removed before ever getting the chance to syncAll\")},0)),document.body.removeEventListener(\"connected\",this.onConnected,!1)},isMine:function(){return this.data.owner===NAF.clientId},createdByMe:function(){return this.data.creator===NAF.clientId},tick:function(e,t){if(!this.isMine()&&NAF.options.useLerp)for(var n=0;n<this.bufferInfos.length;n++){var i=this.bufferInfos[n],s=i.buffer,o=i.object3D,r=i.componentNames;s.update(t),r.includes(\"position\")&&o.position.copy(s.getPosition()),r.includes(\"rotation\")&&o.quaternion.copy(s.getQuaternion()),r.includes(\"scale\")&&o.scale.copy(s.getScale())}},syncAll:function(e,t){if(this.canSync()){var n=this.gatherComponentsData(!0),i=this.createSyncData(n,t);e?NAF.connection.sendDataGuaranteed(e,\"u\",i):NAF.connection.broadcastDataGuaranteed(\"u\",i)}},syncDirty:function(){if(this.canSync()){var e=this.gatherComponentsData(!1);if(null!==e)return this.createSyncData(e)}},getCachedElement(e){var t=this.cachedElements[e];if(t)return t;var n=this.componentSchemas[e];return n.selector?this.cachedElements[e]=this.el.querySelector(n.selector):this.cachedElements[e]=this.el},invalidateCachedElements(){for(var e=0;e<this.cachedElements.length;e++)this.cachedElements[e]=null},gatherComponentsData:function(e){for(var t=null,n=0;n<this.componentSchemas.length;n++){var i=this.componentSchemas[n],s=this.getCachedElement(n);if(s){var o=i.component?i.component:i,r=s.getAttribute(o);if(null!==r){var a=i.property?r[i.property]:r;(this.networkUpdatePredicates[n](a)||e)&&((t=t||{})[n]=a)}else e&&((t=t||{})[n]=null)}else e&&((t=t||{})[n]=null)}return t},createSyncData:function(e,t){var{syncData:n,data:i}=this;return n.networkId=i.networkId,n.owner=i.owner,n.creator=i.creator,n.lastOwnerTime=this.lastOwnerTime,n.template=i.template,n.persistent=i.persistent,n.parent=this.getParentId(),n.components=e,n.isFirstSync=!!t,n},canSync:function(){if(this.data.owner&&this.isMine())return!0;if(!this.createdByMe())return!1;const e=NAF.connection.getConnectedClients();for(let t in e)if(t===this.data.owner)return!1;return!0},getParentId:function(){return this.initNetworkParent(),this.parent?this.parent.getAttribute(\"networked\").networkId:null},networkUpdate:function(e){if(!(e.lastOwnerTime<this.lastOwnerTime||this.lastOwnerTime===e.lastOwnerTime&&this.data.owner>e.owner)){if(this.data.owner!==e.owner){var t=this.isMine();this.lastOwnerTime=e.lastOwnerTime;const n=this.data.owner,i=e.owner;this.el.setAttribute(\"networked\",{owner:e.owner}),t&&(this.onOwnershipLostEvent.newOwner=i,this.el.emit(this.OWNERSHIP_LOST,this.onOwnershipLostEvent)),this.onOwnershipChangedEvent.oldOwner=n,this.onOwnershipChangedEvent.newOwner=i,this.el.emit(this.OWNERSHIP_CHANGED,this.onOwnershipChangedEvent)}this.data.persistent!==e.persistent&&this.el.setAttribute(\"networked\",{persistent:e.persistent}),this.updateNetworkedComponents(e.components)}},updateNetworkedComponents:function(e){for(var t=0,n=this.componentSchemas.length;t<n;t++){var i=e[t],s=this.componentSchemas[t],o=this.getCachedElement(t);null!==o&&null!==i&&void 0!==i&&(s.component?s.property?this.updateNetworkedComponent(o,s.component,s.property,i):this.updateNetworkedComponent(o,s.component,i):this.updateNetworkedComponent(o,s,i))}},updateNetworkedComponent:function(e,t,n,i){if(!NAF.options.useLerp||!r.includes(t))return void(void 0===i?e.setAttribute(t,n):e.setAttribute(t,n,i));let a;for(let s=0,o=this.bufferInfos.length;s<o;s++){const t=this.bufferInfos[s];if(t.object3D===e.object3D){a=t;break}}if(a){var c=a.componentNames;c.includes(t)||c.push(t)}else a={buffer:new s(s.MODE_LERP,.1),object3D:e.object3D,componentNames:[t]},this.bufferInfos.push(a);var h=a.buffer;switch(t){case\"position\":return void h.setPosition(this.bufferPosition.set(n.x,n.y,n.z));case\"rotation\":return this.conversionEuler.set(o*n.x,o*n.y,o*n.z),void h.setQuaternion(this.bufferQuaternion.setFromEuler(this.conversionEuler));case\"scale\":return void h.setScale(this.bufferScale.set(n.x,n.y,n.z))}NAF.log.error(\"Could not set value in interpolation buffer.\",e,t,n,a)},removeLerp:function(){this.bufferInfos=[]},remove:function(){if(this.isMine()&&NAF.connection.isConnected()){var e={networkId:this.data.networkId};NAF.entities.hasEntity(this.data.networkId)?NAF.connection.broadcastDataGuaranteed(\"r\",e):NAF.log.error(\"Removing networked entity that is not in entities array.\")}NAF.entities.forgetEntity(this.data.networkId),document.body.dispatchEvent(this.entityRemovedEvent(this.data.networkId)),this.el.sceneEl.systems.networked.deregister(this)},entityCreatedEvent(){return new CustomEvent(\"entityCreated\",{detail:{el:this.el}})},entityRemovedEvent:e=>new CustomEvent(\"entityRemoved\",{detail:{networkId:e}})})},\"zs+I\":function(e,t,n){\"use strict\";var i=Array.isArray,s=Object.keys,o=Object.prototype.hasOwnProperty;e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&\"object\"==typeof t&&\"object\"==typeof n){var r,a,c,h=i(t),d=i(n);if(h&&d){if((a=t.length)!=n.length)return!1;for(r=a;0!==r--;)if(!e(t[r],n[r]))return!1;return!0}if(h!=d)return!1;var l=t instanceof Date,u=n instanceof Date;if(l!=u)return!1;if(l&&u)return t.getTime()==n.getTime();var p=t instanceof RegExp,m=n instanceof RegExp;if(p!=m)return!1;if(p&&m)return t.toString()==n.toString();var f=s(t);if((a=f.length)!==s(n).length)return!1;for(r=a;0!==r--;)if(!o.call(n,f[r]))return!1;for(r=a;0!==r--;)if(!e(t[c=f[r]],n[c]))return!1;return!0}return t!==t&&n!==n}}}]);"}