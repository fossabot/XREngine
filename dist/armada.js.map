{"version":3,"file":"armada.js","sources":["../node_modules/ecsy/src/Utils.js","../node_modules/ecsy/src/EventDispatcher.js","../node_modules/ecsy/src/Query.js","../node_modules/ecsy/src/Component.js","../node_modules/ecsy/src/System.js","../node_modules/ecsy/src/Types.js","../node_modules/ecsy/src/RemoteDevTools/utils.js","../node_modules/ecsy/src/RemoteDevTools/index.js"],"sourcesContent":["/**\n * Return the name of a component\n * @param {Component} Component\n * @private\n */\nexport function getName(Component) {\n  return Component.name;\n}\n\n/**\n * Return a valid property name for the Component\n * @param {Component} Component\n * @private\n */\nexport function componentPropertyName(Component) {\n  return getName(Component);\n}\n\n/**\n * Get a key from a list of components\n * @param {Array(Component)} Components Array of components to generate the key\n * @private\n */\nexport function queryKey(Components) {\n  var names = [];\n  for (var n = 0; n < Components.length; n++) {\n    var T = Components[n];\n    if (typeof T === \"object\") {\n      var operator = T.operator === \"not\" ? \"!\" : T.operator;\n      names.push(operator + getName(T.Component));\n    } else {\n      names.push(getName(T));\n    }\n  }\n\n  return names.sort().join(\"-\");\n}\n\n// Detector for browser's \"window\"\nexport const hasWindow = typeof window !== \"undefined\";\n\n// performance.now() \"polyfill\"\nexport const now =\n  hasWindow && typeof window.performance !== \"undefined\"\n    ? performance.now.bind(performance)\n    : Date.now.bind(Date);\n","/**\n * @private\n * @class EventDispatcher\n */\nexport default class EventDispatcher {\n  constructor() {\n    this._listeners = {};\n    this.stats = {\n      fired: 0,\n      handled: 0\n    };\n  }\n\n  /**\n   * Add an event listener\n   * @param {String} eventName Name of the event to listen\n   * @param {Function} listener Callback to trigger when the event is fired\n   */\n  addEventListener(eventName, listener) {\n    let listeners = this._listeners;\n    if (listeners[eventName] === undefined) {\n      listeners[eventName] = [];\n    }\n\n    if (listeners[eventName].indexOf(listener) === -1) {\n      listeners[eventName].push(listener);\n    }\n  }\n\n  /**\n   * Check if an event listener is already added to the list of listeners\n   * @param {String} eventName Name of the event to check\n   * @param {Function} listener Callback for the specified event\n   */\n  hasEventListener(eventName, listener) {\n    return (\n      this._listeners[eventName] !== undefined &&\n      this._listeners[eventName].indexOf(listener) !== -1\n    );\n  }\n\n  /**\n   * Remove an event listener\n   * @param {String} eventName Name of the event to remove\n   * @param {Function} listener Callback for the specified event\n   */\n  removeEventListener(eventName, listener) {\n    var listenerArray = this._listeners[eventName];\n    if (listenerArray !== undefined) {\n      var index = listenerArray.indexOf(listener);\n      if (index !== -1) {\n        listenerArray.splice(index, 1);\n      }\n    }\n  }\n\n  /**\n   * Dispatch an event\n   * @param {String} eventName Name of the event to dispatch\n   * @param {Entity} entity (Optional) Entity to emit\n   * @param {Component} component\n   */\n  dispatchEvent(eventName, entity, component) {\n    this.stats.fired++;\n\n    var listenerArray = this._listeners[eventName];\n    if (listenerArray !== undefined) {\n      var array = listenerArray.slice(0);\n\n      for (var i = 0; i < array.length; i++) {\n        array[i].call(this, entity, component);\n      }\n    }\n  }\n\n  /**\n   * Reset stats counters\n   */\n  resetCounters() {\n    this.stats.fired = this.stats.handled = 0;\n  }\n}\n","import EventDispatcher from \"./EventDispatcher.js\";\nimport { queryKey } from \"./Utils.js\";\n\nexport default class Query {\n  /**\n   * @param {Array(Component)} Components List of types of components to query\n   */\n  constructor(Components, manager) {\n    this.Components = [];\n    this.NotComponents = [];\n\n    Components.forEach(component => {\n      if (typeof component === \"object\") {\n        this.NotComponents.push(component.Component);\n      } else {\n        this.Components.push(component);\n      }\n    });\n\n    if (this.Components.length === 0) {\n      throw new Error(\"Can't create a query without components\");\n    }\n\n    this.entities = [];\n\n    this.eventDispatcher = new EventDispatcher();\n\n    // This query is being used by a reactive system\n    this.reactive = false;\n\n    this.key = queryKey(Components);\n\n    // Fill the query with the existing entities\n    for (var i = 0; i < manager._entities.length; i++) {\n      var entity = manager._entities[i];\n      if (this.match(entity)) {\n        // @todo ??? this.addEntity(entity); => preventing the event to be generated\n        entity.queries.push(this);\n        this.entities.push(entity);\n      }\n    }\n  }\n\n  /**\n   * Add entity to this query\n   * @param {Entity} entity\n   */\n  addEntity(entity) {\n    entity.queries.push(this);\n    this.entities.push(entity);\n\n    this.eventDispatcher.dispatchEvent(Query.prototype.ENTITY_ADDED, entity);\n  }\n\n  /**\n   * Remove entity from this query\n   * @param {Entity} entity\n   */\n  removeEntity(entity) {\n    let index = this.entities.indexOf(entity);\n    if (~index) {\n      this.entities.splice(index, 1);\n\n      index = entity.queries.indexOf(this);\n      entity.queries.splice(index, 1);\n\n      this.eventDispatcher.dispatchEvent(\n        Query.prototype.ENTITY_REMOVED,\n        entity\n      );\n    }\n  }\n\n  match(entity) {\n    return (\n      entity.hasAllComponents(this.Components) &&\n      !entity.hasAnyComponents(this.NotComponents)\n    );\n  }\n\n  toJSON() {\n    return {\n      key: this.key,\n      reactive: this.reactive,\n      components: {\n        included: this.Components.map(C => C.name),\n        not: this.NotComponents.map(C => C.name)\n      },\n      numEntities: this.entities.length\n    };\n  }\n\n  /**\n   * Return stats for this query\n   */\n  stats() {\n    return {\n      numComponents: this.Components.length,\n      numEntities: this.entities.length\n    };\n  }\n}\n\nQuery.prototype.ENTITY_ADDED = \"Query#ENTITY_ADDED\";\nQuery.prototype.ENTITY_REMOVED = \"Query#ENTITY_REMOVED\";\nQuery.prototype.COMPONENT_CHANGED = \"Query#COMPONENT_CHANGED\";\n","export class Component {\n  constructor(props) {\n    if (props !== false) {\n      const schema = this.constructor.schema;\n\n      for (const key in schema) {\n        if (props && props.hasOwnProperty(key)) {\n          this[key] = props[key];\n        } else {\n          const schemaProp = schema[key];\n          if (schemaProp.hasOwnProperty(\"default\")) {\n            this[key] = schemaProp.type.clone(schemaProp.default);\n          } else {\n            const type = schemaProp.type;\n            this[key] = type.clone(type.default);\n          }\n        }\n      }\n    }\n\n    this._pool = null;\n  }\n\n  copy(source) {\n    const schema = this.constructor.schema;\n\n    for (const key in schema) {\n      const prop = schema[key];\n\n      if (source.hasOwnProperty(key)) {\n        this[key] = prop.type.copy(source[key], this[key]);\n      }\n    }\n\n    return this;\n  }\n\n  clone() {\n    return new this.constructor().copy(this);\n  }\n\n  reset() {\n    const schema = this.constructor.schema;\n\n    for (const key in schema) {\n      const schemaProp = schema[key];\n\n      if (schemaProp.hasOwnProperty(\"default\")) {\n        this[key] = schemaProp.type.copy(schemaProp.default, this[key]);\n      } else {\n        const type = schemaProp.type;\n        this[key] = type.copy(type.default, this[key]);\n      }\n    }\n  }\n\n  dispose() {\n    if (this._pool) {\n      this._pool.release(this);\n    }\n  }\n\n  getName() {\n    return this.constructor.getName();\n  }\n}\n\nComponent.schema = {};\nComponent.isComponent = true;\nComponent.getName = function() {\n  return this.displayName || this.name;\n};\n","import Query from \"./Query.js\";\n\nexport class System {\n  canExecute() {\n    if (this._mandatoryQueries.length === 0) return true;\n\n    for (let i = 0; i < this._mandatoryQueries.length; i++) {\n      var query = this._mandatoryQueries[i];\n      if (query.entities.length === 0) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  getName() {\n    return this.constructor.getName();\n  }\n\n  constructor(world, attributes) {\n    this.world = world;\n    this.enabled = true;\n\n    // @todo Better naming :)\n    this._queries = {};\n    this.queries = {};\n\n    this.priority = 0;\n\n    // Used for stats\n    this.executeTime = 0;\n\n    if (attributes && attributes.priority) {\n      this.priority = attributes.priority;\n    }\n\n    this._mandatoryQueries = [];\n\n    this.initialized = true;\n\n    if (this.constructor.queries) {\n      for (var queryName in this.constructor.queries) {\n        var queryConfig = this.constructor.queries[queryName];\n        var Components = queryConfig.components;\n        if (!Components || Components.length === 0) {\n          throw new Error(\"'components' attribute can't be empty in a query\");\n        }\n        var query = this.world.entityManager.queryComponents(Components);\n        this._queries[queryName] = query;\n        if (queryConfig.mandatory === true) {\n          this._mandatoryQueries.push(query);\n        }\n        this.queries[queryName] = {\n          results: query.entities\n        };\n\n        // Reactive configuration added/removed/changed\n        var validEvents = [\"added\", \"removed\", \"changed\"];\n\n        const eventMapping = {\n          added: Query.prototype.ENTITY_ADDED,\n          removed: Query.prototype.ENTITY_REMOVED,\n          changed: Query.prototype.COMPONENT_CHANGED // Query.prototype.ENTITY_CHANGED\n        };\n\n        if (queryConfig.listen) {\n          validEvents.forEach(eventName => {\n            if (!this.execute) {\n              console.warn(\n                `System '${this.getName()}' has defined listen events (${validEvents.join(\n                  \", \"\n                )}) for query '${queryName}' but it does not implement the 'execute' method.`\n              );\n            }\n\n            // Is the event enabled on this system's query?\n            if (queryConfig.listen[eventName]) {\n              let event = queryConfig.listen[eventName];\n\n              if (eventName === \"changed\") {\n                query.reactive = true;\n                if (event === true) {\n                  // Any change on the entity from the components in the query\n                  let eventList = (this.queries[queryName][eventName] = []);\n                  query.eventDispatcher.addEventListener(\n                    Query.prototype.COMPONENT_CHANGED,\n                    entity => {\n                      // Avoid duplicates\n                      if (eventList.indexOf(entity) === -1) {\n                        eventList.push(entity);\n                      }\n                    }\n                  );\n                } else if (Array.isArray(event)) {\n                  let eventList = (this.queries[queryName][eventName] = []);\n                  query.eventDispatcher.addEventListener(\n                    Query.prototype.COMPONENT_CHANGED,\n                    (entity, changedComponent) => {\n                      // Avoid duplicates\n                      if (\n                        event.indexOf(changedComponent.constructor) !== -1 &&\n                        eventList.indexOf(entity) === -1\n                      ) {\n                        eventList.push(entity);\n                      }\n                    }\n                  );\n                } else {\n                  /*\n                  // Checking just specific components\n                  let changedList = (this.queries[queryName][eventName] = {});\n                  event.forEach(component => {\n                    let eventList = (changedList[\n                      componentPropertyName(component)\n                    ] = []);\n                    query.eventDispatcher.addEventListener(\n                      Query.prototype.COMPONENT_CHANGED,\n                      (entity, changedComponent) => {\n                        if (\n                          changedComponent.constructor === component &&\n                          eventList.indexOf(entity) === -1\n                        ) {\n                          eventList.push(entity);\n                        }\n                      }\n                    );\n                  });\n                  */\n                }\n              } else {\n                let eventList = (this.queries[queryName][eventName] = []);\n\n                query.eventDispatcher.addEventListener(\n                  eventMapping[eventName],\n                  entity => {\n                    // @fixme overhead?\n                    if (eventList.indexOf(entity) === -1)\n                      eventList.push(entity);\n                  }\n                );\n              }\n            }\n          });\n        }\n      }\n    }\n  }\n\n  stop() {\n    this.executeTime = 0;\n    this.enabled = false;\n  }\n\n  play() {\n    this.enabled = true;\n  }\n\n  // @question rename to clear queues?\n  clearEvents() {\n    for (let queryName in this.queries) {\n      var query = this.queries[queryName];\n      if (query.added) {\n        query.added.length = 0;\n      }\n      if (query.removed) {\n        query.removed.length = 0;\n      }\n      if (query.changed) {\n        if (Array.isArray(query.changed)) {\n          query.changed.length = 0;\n        } else {\n          for (let name in query.changed) {\n            query.changed[name].length = 0;\n          }\n        }\n      }\n    }\n  }\n\n  toJSON() {\n    var json = {\n      name: this.getName(),\n      enabled: this.enabled,\n      executeTime: this.executeTime,\n      priority: this.priority,\n      queries: {}\n    };\n\n    if (this.constructor.queries) {\n      var queries = this.constructor.queries;\n      for (let queryName in queries) {\n        let query = this.queries[queryName];\n        let queryDefinition = queries[queryName];\n        let jsonQuery = (json.queries[queryName] = {\n          key: this._queries[queryName].key\n        });\n\n        jsonQuery.mandatory = queryDefinition.mandatory === true;\n        jsonQuery.reactive =\n          queryDefinition.listen &&\n          (queryDefinition.listen.added === true ||\n            queryDefinition.listen.removed === true ||\n            queryDefinition.listen.changed === true ||\n            Array.isArray(queryDefinition.listen.changed));\n\n        if (jsonQuery.reactive) {\n          jsonQuery.listen = {};\n\n          const methods = [\"added\", \"removed\", \"changed\"];\n          methods.forEach(method => {\n            if (query[method]) {\n              jsonQuery.listen[method] = {\n                entities: query[method].length\n              };\n            }\n          });\n        }\n      }\n    }\n\n    return json;\n  }\n}\n\nSystem.isSystem = true;\nSystem.getName = function() {\n  return this.displayName || this.name;\n};\n\nexport function Not(Component) {\n  return {\n    operator: \"not\",\n    Component: Component\n  };\n}\n","export const copyValue = src => src;\n\nexport const cloneValue = src => src;\n\nexport const copyArray = (src, dest) => {\n  if (!src) {\n    return src;\n  }\n\n  if (!dest) {\n    return src.slice();\n  }\n\n  dest.length = 0;\n\n  for (let i = 0; i < src.length; i++) {\n    dest.push(src[i]);\n  }\n\n  return dest;\n};\n\nexport const cloneArray = src => src && src.slice();\n\nexport const copyJSON = src => JSON.parse(JSON.stringify(src));\n\nexport const cloneJSON = src => JSON.parse(JSON.stringify(src));\n\nexport const copyCopyable = (src, dest) => {\n  if (!src) {\n    return src;\n  }\n\n  if (!dest) {\n    return src.clone();\n  }\n\n  return dest.copy(src);\n};\n\nexport const cloneClonable = src => src && src.clone();\n\nexport function createType(typeDefinition) {\n  var mandatoryProperties = [\"name\", \"default\", \"copy\", \"clone\"];\n\n  var undefinedProperties = mandatoryProperties.filter(p => {\n    return !typeDefinition.hasOwnProperty(p);\n  });\n\n  if (undefinedProperties.length > 0) {\n    throw new Error(\n      `createType expects a type definition with the following properties: ${undefinedProperties.join(\n        \", \"\n      )}`\n    );\n  }\n\n  typeDefinition.isType = true;\n\n  return typeDefinition;\n}\n\n/**\n * Standard types\n */\nexport const Types = {\n  Number: createType({\n    name: \"Number\",\n    default: 0,\n    copy: copyValue,\n    clone: cloneValue\n  }),\n\n  Boolean: createType({\n    name: \"Boolean\",\n    default: false,\n    copy: copyValue,\n    clone: cloneValue\n  }),\n\n  String: createType({\n    name: \"String\",\n    default: \"\",\n    copy: copyValue,\n    clone: cloneValue\n  }),\n\n  Array: createType({\n    name: \"Array\",\n    default: [],\n    copy: copyArray,\n    clone: cloneArray\n  }),\n\n  Ref: createType({\n    name: \"Ref\",\n    default: undefined,\n    copy: copyValue,\n    clone: cloneValue\n  }),\n\n  JSON: createType({\n    name: \"JSON\",\n    default: null,\n    copy: copyJSON,\n    clone: cloneJSON\n  })\n};\n","export function generateId(length) {\n  var result = \"\";\n  var characters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n  var charactersLength = characters.length;\n  for (var i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\n\nexport function injectScript(src, onLoad) {\n  var script = document.createElement(\"script\");\n  // @todo Use link to the ecsy-devtools repo?\n  script.src = src;\n  script.onload = onLoad;\n  (document.head || document.documentElement).appendChild(script);\n}\n","/* global Peer */\nimport { injectScript, generateId } from \"./utils.js\";\nimport { hasWindow } from \"../Utils.js\";\n\nfunction hookConsoleAndErrors(connection) {\n  var wrapFunctions = [\"error\", \"warning\", \"log\"];\n  wrapFunctions.forEach(key => {\n    if (typeof console[key] === \"function\") {\n      var fn = console[key].bind(console);\n      console[key] = (...args) => {\n        connection.send({\n          method: \"console\",\n          type: key,\n          args: JSON.stringify(args)\n        });\n        return fn.apply(null, args);\n      };\n    }\n  });\n\n  window.addEventListener(\"error\", error => {\n    connection.send({\n      method: \"error\",\n      error: JSON.stringify({\n        message: error.error.message,\n        stack: error.error.stack\n      })\n    });\n  });\n}\n\nfunction includeRemoteIdHTML(remoteId) {\n  let infoDiv = document.createElement(\"div\");\n  infoDiv.style.cssText = `\n    align-items: center;\n    background-color: #333;\n    color: #aaa;\n    display:flex;\n    font-family: Arial;\n    font-size: 1.1em;\n    height: 40px;\n    justify-content: center;\n    left: 0;\n    opacity: 0.9;\n    position: absolute;\n    right: 0;\n    text-align: center;\n    top: 0;\n  `;\n\n  infoDiv.innerHTML = `Open ECSY devtools to connect to this page using the code:&nbsp;<b style=\"color: #fff\">${remoteId}</b>&nbsp;<button onClick=\"generateNewCode()\">Generate new code</button>`;\n  document.body.appendChild(infoDiv);\n\n  return infoDiv;\n}\n\nexport function enableRemoteDevtools(remoteId) {\n  if (!hasWindow) {\n    console.warn(\"Remote devtools not available outside the browser\");\n    return;\n  }\n\n  window.generateNewCode = () => {\n    window.localStorage.clear();\n    remoteId = generateId(6);\n    window.localStorage.setItem(\"ecsyRemoteId\", remoteId);\n    window.location.reload(false);\n  };\n\n  remoteId = remoteId || window.localStorage.getItem(\"ecsyRemoteId\");\n  if (!remoteId) {\n    remoteId = generateId(6);\n    window.localStorage.setItem(\"ecsyRemoteId\", remoteId);\n  }\n\n  let infoDiv = includeRemoteIdHTML(remoteId);\n\n  window.__ECSY_REMOTE_DEVTOOLS_INJECTED = true;\n  window.__ECSY_REMOTE_DEVTOOLS = {};\n\n  let Version = \"\";\n\n  // This is used to collect the worlds created before the communication is being established\n  let worldsBeforeLoading = [];\n  let onWorldCreated = e => {\n    var world = e.detail.world;\n    Version = e.detail.version;\n    worldsBeforeLoading.push(world);\n  };\n  window.addEventListener(\"ecsy-world-created\", onWorldCreated);\n\n  let onLoaded = () => {\n    var peer = new Peer(remoteId);\n    peer.on(\"open\", (/* id */) => {\n      peer.on(\"connection\", connection => {\n        window.__ECSY_REMOTE_DEVTOOLS.connection = connection;\n        connection.on(\"open\", function() {\n          // infoDiv.style.visibility = \"hidden\";\n          infoDiv.innerHTML = \"Connected\";\n\n          // Receive messages\n          connection.on(\"data\", function(data) {\n            if (data.type === \"init\") {\n              var script = document.createElement(\"script\");\n              script.setAttribute(\"type\", \"text/javascript\");\n              script.onload = () => {\n                script.parentNode.removeChild(script);\n\n                // Once the script is injected we don't need to listen\n                window.removeEventListener(\n                  \"ecsy-world-created\",\n                  onWorldCreated\n                );\n                worldsBeforeLoading.forEach(world => {\n                  var event = new CustomEvent(\"ecsy-world-created\", {\n                    detail: { world: world, version: Version }\n                  });\n                  window.dispatchEvent(event);\n                });\n              };\n              script.innerHTML = data.script;\n              (document.head || document.documentElement).appendChild(script);\n              script.onload();\n\n              hookConsoleAndErrors(connection);\n            } else if (data.type === \"executeScript\") {\n              let value = eval(data.script);\n              if (data.returnEval) {\n                connection.send({\n                  method: \"evalReturn\",\n                  value: value\n                });\n              }\n            }\n          });\n        });\n      });\n    });\n  };\n\n  // Inject PeerJS script\n  injectScript(\n    \"https://cdn.jsdelivr.net/npm/peerjs@0.3.20/dist/peer.min.js\",\n    onLoaded\n  );\n}\n\nif (hasWindow) {\n  const urlParams = new URLSearchParams(window.location.search);\n\n  // @todo Provide a way to disable it if needed\n  if (urlParams.has(\"enable-remote-devtools\")) {\n    enableRemoteDevtools();\n  }\n}\n"],"names":["getName","Component","name","queryKey","Components","names","n","length","T","operator","push","sort","join","hasWindow","window","now","performance","bind","Date","EventDispatcher","constructor","_listeners","stats","fired","handled","addEventListener","eventName","listener","listeners","undefined","indexOf","hasEventListener","removeEventListener","listenerArray","index","splice","dispatchEvent","entity","component","array","slice","i","call","resetCounters","Query","manager","NotComponents","forEach","Error","entities","eventDispatcher","reactive","key","_entities","match","queries","addEntity","prototype","ENTITY_ADDED","removeEntity","ENTITY_REMOVED","hasAllComponents","hasAnyComponents","toJSON","components","included","map","C","not","numEntities","numComponents","COMPONENT_CHANGED","props","schema","hasOwnProperty","schemaProp","type","clone","default","_pool","copy","source","prop","reset","dispose","release","isComponent","displayName","System","canExecute","_mandatoryQueries","query","world","attributes","enabled","_queries","priority","executeTime","initialized","queryName","queryConfig","entityManager","queryComponents","mandatory","results","validEvents","eventMapping","added","removed","changed","listen","execute","console","warn","event","eventList","Array","isArray","changedComponent","stop","play","clearEvents","json","queryDefinition","jsonQuery","methods","method","isSystem","copyValue","src","cloneValue","copyArray","dest","cloneArray","copyJSON","JSON","parse","stringify","cloneJSON","createType","typeDefinition","mandatoryProperties","undefinedProperties","filter","p","isType","Types","Number","Boolean","String","Ref","generateId","result","characters","charactersLength","charAt","Math","floor","random","injectScript","onLoad","script","document","createElement","onload","head","documentElement","appendChild","hookConsoleAndErrors","connection","wrapFunctions","fn","args","send","apply","error","message","stack","includeRemoteIdHTML","remoteId","infoDiv","style","cssText","innerHTML","body","enableRemoteDevtools","generateNewCode","localStorage","clear","setItem","location","reload","getItem","__ECSY_REMOTE_DEVTOOLS_INJECTED","__ECSY_REMOTE_DEVTOOLS","Version","worldsBeforeLoading","onWorldCreated","e","detail","version","onLoaded","peer","Peer","on","data","setAttribute","parentNode","removeChild","CustomEvent","value","eval","returnEval","urlParams","URLSearchParams","search","has"],"mappings":"AAAA;;;;;AAKO,SAASA,OAAT,CAAiBC,SAAjB,EAA4B;AACjC,SAAOA,SAAS,CAACC,IAAjB;AACD;AAWD;;;;;;AAKO,SAASC,QAAT,CAAkBC,UAAlB,EAA8B;AACnC,MAAIC,KAAK,GAAG,EAAZ;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,UAAU,CAACG,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AAC1C,QAAIE,CAAC,GAAGJ,UAAU,CAACE,CAAD,CAAlB;;AACA,QAAI,OAAOE,CAAP,KAAa,QAAjB,EAA2B;AACzB,UAAIC,QAAQ,GAAGD,CAAC,CAACC,QAAF,KAAe,KAAf,GAAuB,GAAvB,GAA6BD,CAAC,CAACC,QAA9C;AACAJ,MAAAA,KAAK,CAACK,IAAN,CAAWD,QAAQ,GAAGT,OAAO,CAACQ,CAAC,CAACP,SAAH,CAA7B;AACD,KAHD,MAGO;AACLI,MAAAA,KAAK,CAACK,IAAN,CAAWV,OAAO,CAACQ,CAAD,CAAlB;AACD;AACF;;AAED,SAAOH,KAAK,CAACM,IAAN,GAAaC,IAAb,CAAkB,GAAlB,CAAP;AACD;;AAGM,MAAMC,SAAS,GAAG,OAAOC,MAAP,KAAkB,WAApC;;AAGA,MAAMC,GAAG,GACdF,SAAS,IAAI,OAAOC,MAAM,CAACE,WAAd,KAA8B,WAA3C,GACIA,WAAW,CAACD,GAAZ,CAAgBE,IAAhB,CAAqBD,WAArB,CADJ,GAEIE,IAAI,CAACH,GAAL,CAASE,IAAT,CAAcC,IAAd,CAHC;;AC1CP;;;;AAIA,AAAe,MAAMC,eAAN,CAAsB;AACnCC,EAAAA,WAAW,GAAG;AACZ,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,KAAL,GAAa;AACXC,MAAAA,KAAK,EAAE,CADI;AAEXC,MAAAA,OAAO,EAAE;AAFE,KAAb;AAID;AAED;;;;;;;AAKAC,EAAAA,gBAAgB,CAACC,SAAD,EAAYC,QAAZ,EAAsB;AACpC,QAAIC,SAAS,GAAG,KAAKP,UAArB;;AACA,QAAIO,SAAS,CAACF,SAAD,CAAT,KAAyBG,SAA7B,EAAwC;AACtCD,MAAAA,SAAS,CAACF,SAAD,CAAT,GAAuB,EAAvB;AACD;;AAED,QAAIE,SAAS,CAACF,SAAD,CAAT,CAAqBI,OAArB,CAA6BH,QAA7B,MAA2C,CAAC,CAAhD,EAAmD;AACjDC,MAAAA,SAAS,CAACF,SAAD,CAAT,CAAqBhB,IAArB,CAA0BiB,QAA1B;AACD;AACF;AAED;;;;;;;AAKAI,EAAAA,gBAAgB,CAACL,SAAD,EAAYC,QAAZ,EAAsB;AACpC,WACE,KAAKN,UAAL,CAAgBK,SAAhB,MAA+BG,SAA/B,IACA,KAAKR,UAAL,CAAgBK,SAAhB,EAA2BI,OAA3B,CAAmCH,QAAnC,MAAiD,CAAC,CAFpD;AAID;AAED;;;;;;;AAKAK,EAAAA,mBAAmB,CAACN,SAAD,EAAYC,QAAZ,EAAsB;AACvC,QAAIM,aAAa,GAAG,KAAKZ,UAAL,CAAgBK,SAAhB,CAApB;;AACA,QAAIO,aAAa,KAAKJ,SAAtB,EAAiC;AAC/B,UAAIK,KAAK,GAAGD,aAAa,CAACH,OAAd,CAAsBH,QAAtB,CAAZ;;AACA,UAAIO,KAAK,KAAK,CAAC,CAAf,EAAkB;AAChBD,QAAAA,aAAa,CAACE,MAAd,CAAqBD,KAArB,EAA4B,CAA5B;AACD;AACF;AACF;AAED;;;;;;;;AAMAE,EAAAA,aAAa,CAACV,SAAD,EAAYW,MAAZ,EAAoBC,SAApB,EAA+B;AAC1C,SAAKhB,KAAL,CAAWC,KAAX;AAEA,QAAIU,aAAa,GAAG,KAAKZ,UAAL,CAAgBK,SAAhB,CAApB;;AACA,QAAIO,aAAa,KAAKJ,SAAtB,EAAiC;AAC/B,UAAIU,KAAK,GAAGN,aAAa,CAACO,KAAd,CAAoB,CAApB,CAAZ;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,KAAK,CAAChC,MAA1B,EAAkCkC,CAAC,EAAnC,EAAuC;AACrCF,QAAAA,KAAK,CAACE,CAAD,CAAL,CAASC,IAAT,CAAc,IAAd,EAAoBL,MAApB,EAA4BC,SAA5B;AACD;AACF;AACF;AAED;;;;;AAGAK,EAAAA,aAAa,GAAG;AACd,SAAKrB,KAAL,CAAWC,KAAX,GAAmB,KAAKD,KAAL,CAAWE,OAAX,GAAqB,CAAxC;AACD;;AA5EkC;;ACDtB,MAAMoB,KAAN,CAAY;AACzB;;;AAGAxB,EAAAA,WAAW,CAAChB,UAAD,EAAayC,OAAb,EAAsB;AAC/B,SAAKzC,UAAL,GAAkB,EAAlB;AACA,SAAK0C,aAAL,GAAqB,EAArB;AAEA1C,IAAAA,UAAU,CAAC2C,OAAX,CAAmBT,SAAS,IAAI;AAC9B,UAAI,OAAOA,SAAP,KAAqB,QAAzB,EAAmC;AACjC,aAAKQ,aAAL,CAAmBpC,IAAnB,CAAwB4B,SAAS,CAACrC,SAAlC;AACD,OAFD,MAEO;AACL,aAAKG,UAAL,CAAgBM,IAAhB,CAAqB4B,SAArB;AACD;AACF,KAND;;AAQA,QAAI,KAAKlC,UAAL,CAAgBG,MAAhB,KAA2B,CAA/B,EAAkC;AAChC,YAAM,IAAIyC,KAAJ,CAAU,yCAAV,CAAN;AACD;;AAED,SAAKC,QAAL,GAAgB,EAAhB;AAEA,SAAKC,eAAL,GAAuB,IAAI/B,eAAJ,EAAvB,CAlB+B;;AAqB/B,SAAKgC,QAAL,GAAgB,KAAhB;AAEA,SAAKC,GAAL,GAAWjD,QAAQ,CAACC,UAAD,CAAnB,CAvB+B;;AA0B/B,SAAK,IAAIqC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGI,OAAO,CAACQ,SAAR,CAAkB9C,MAAtC,EAA8CkC,CAAC,EAA/C,EAAmD;AACjD,UAAIJ,MAAM,GAAGQ,OAAO,CAACQ,SAAR,CAAkBZ,CAAlB,CAAb;;AACA,UAAI,KAAKa,KAAL,CAAWjB,MAAX,CAAJ,EAAwB;AACtB;AACAA,QAAAA,MAAM,CAACkB,OAAP,CAAe7C,IAAf,CAAoB,IAApB;AACA,aAAKuC,QAAL,CAAcvC,IAAd,CAAmB2B,MAAnB;AACD;AACF;AACF;AAED;;;;;;AAIAmB,EAAAA,SAAS,CAACnB,MAAD,EAAS;AAChBA,IAAAA,MAAM,CAACkB,OAAP,CAAe7C,IAAf,CAAoB,IAApB;AACA,SAAKuC,QAAL,CAAcvC,IAAd,CAAmB2B,MAAnB;AAEA,SAAKa,eAAL,CAAqBd,aAArB,CAAmCQ,KAAK,CAACa,SAAN,CAAgBC,YAAnD,EAAiErB,MAAjE;AACD;AAED;;;;;;AAIAsB,EAAAA,YAAY,CAACtB,MAAD,EAAS;AACnB,QAAIH,KAAK,GAAG,KAAKe,QAAL,CAAcnB,OAAd,CAAsBO,MAAtB,CAAZ;;AACA,QAAI,CAACH,KAAL,EAAY;AACV,WAAKe,QAAL,CAAcd,MAAd,CAAqBD,KAArB,EAA4B,CAA5B;AAEAA,MAAAA,KAAK,GAAGG,MAAM,CAACkB,OAAP,CAAezB,OAAf,CAAuB,IAAvB,CAAR;AACAO,MAAAA,MAAM,CAACkB,OAAP,CAAepB,MAAf,CAAsBD,KAAtB,EAA6B,CAA7B;AAEA,WAAKgB,eAAL,CAAqBd,aAArB,CACEQ,KAAK,CAACa,SAAN,CAAgBG,cADlB,EAEEvB,MAFF;AAID;AACF;;AAEDiB,EAAAA,KAAK,CAACjB,MAAD,EAAS;AACZ,WACEA,MAAM,CAACwB,gBAAP,CAAwB,KAAKzD,UAA7B,KACA,CAACiC,MAAM,CAACyB,gBAAP,CAAwB,KAAKhB,aAA7B,CAFH;AAID;;AAEDiB,EAAAA,MAAM,GAAG;AACP,WAAO;AACLX,MAAAA,GAAG,EAAE,KAAKA,GADL;AAELD,MAAAA,QAAQ,EAAE,KAAKA,QAFV;AAGLa,MAAAA,UAAU,EAAE;AACVC,QAAAA,QAAQ,EAAE,KAAK7D,UAAL,CAAgB8D,GAAhB,CAAoBC,CAAC,IAAIA,CAAC,CAACjE,IAA3B,CADA;AAEVkE,QAAAA,GAAG,EAAE,KAAKtB,aAAL,CAAmBoB,GAAnB,CAAuBC,CAAC,IAAIA,CAAC,CAACjE,IAA9B;AAFK,OAHP;AAOLmE,MAAAA,WAAW,EAAE,KAAKpB,QAAL,CAAc1C;AAPtB,KAAP;AASD;AAED;;;;;AAGAe,EAAAA,KAAK,GAAG;AACN,WAAO;AACLgD,MAAAA,aAAa,EAAE,KAAKlE,UAAL,CAAgBG,MAD1B;AAEL8D,MAAAA,WAAW,EAAE,KAAKpB,QAAL,CAAc1C;AAFtB,KAAP;AAID;;AAjGwB;AAoG3BqC,KAAK,CAACa,SAAN,CAAgBC,YAAhB,GAA+B,oBAA/B;AACAd,KAAK,CAACa,SAAN,CAAgBG,cAAhB,GAAiC,sBAAjC;AACAhB,KAAK,CAACa,SAAN,CAAgBc,iBAAhB,GAAoC,yBAApC;;ACzGO,MAAMtE,SAAN,CAAgB;AACrBmB,EAAAA,WAAW,CAACoD,KAAD,EAAQ;AACjB,QAAIA,KAAK,KAAK,KAAd,EAAqB;AACnB,YAAMC,MAAM,GAAG,KAAKrD,WAAL,CAAiBqD,MAAhC;;AAEA,WAAK,MAAMrB,GAAX,IAAkBqB,MAAlB,EAA0B;AACxB,YAAID,KAAK,IAAIA,KAAK,CAACE,cAAN,CAAqBtB,GAArB,CAAb,EAAwC;AACtC,eAAKA,GAAL,IAAYoB,KAAK,CAACpB,GAAD,CAAjB;AACD,SAFD,MAEO;AACL,gBAAMuB,UAAU,GAAGF,MAAM,CAACrB,GAAD,CAAzB;;AACA,cAAIuB,UAAU,CAACD,cAAX,CAA0B,SAA1B,CAAJ,EAA0C;AACxC,iBAAKtB,GAAL,IAAYuB,UAAU,CAACC,IAAX,CAAgBC,KAAhB,CAAsBF,UAAU,CAACG,OAAjC,CAAZ;AACD,WAFD,MAEO;AACL,kBAAMF,IAAI,GAAGD,UAAU,CAACC,IAAxB;AACA,iBAAKxB,GAAL,IAAYwB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,OAAhB,CAAZ;AACD;AACF;AACF;AACF;;AAED,SAAKC,KAAL,GAAa,IAAb;AACD;;AAEDC,EAAAA,IAAI,CAACC,MAAD,EAAS;AACX,UAAMR,MAAM,GAAG,KAAKrD,WAAL,CAAiBqD,MAAhC;;AAEA,SAAK,MAAMrB,GAAX,IAAkBqB,MAAlB,EAA0B;AACxB,YAAMS,IAAI,GAAGT,MAAM,CAACrB,GAAD,CAAnB;;AAEA,UAAI6B,MAAM,CAACP,cAAP,CAAsBtB,GAAtB,CAAJ,EAAgC;AAC9B,aAAKA,GAAL,IAAY8B,IAAI,CAACN,IAAL,CAAUI,IAAV,CAAeC,MAAM,CAAC7B,GAAD,CAArB,EAA4B,KAAKA,GAAL,CAA5B,CAAZ;AACD;AACF;;AAED,WAAO,IAAP;AACD;;AAEDyB,EAAAA,KAAK,GAAG;AACN,WAAO,IAAI,KAAKzD,WAAT,GAAuB4D,IAAvB,CAA4B,IAA5B,CAAP;AACD;;AAEDG,EAAAA,KAAK,GAAG;AACN,UAAMV,MAAM,GAAG,KAAKrD,WAAL,CAAiBqD,MAAhC;;AAEA,SAAK,MAAMrB,GAAX,IAAkBqB,MAAlB,EAA0B;AACxB,YAAME,UAAU,GAAGF,MAAM,CAACrB,GAAD,CAAzB;;AAEA,UAAIuB,UAAU,CAACD,cAAX,CAA0B,SAA1B,CAAJ,EAA0C;AACxC,aAAKtB,GAAL,IAAYuB,UAAU,CAACC,IAAX,CAAgBI,IAAhB,CAAqBL,UAAU,CAACG,OAAhC,EAAyC,KAAK1B,GAAL,CAAzC,CAAZ;AACD,OAFD,MAEO;AACL,cAAMwB,IAAI,GAAGD,UAAU,CAACC,IAAxB;AACA,aAAKxB,GAAL,IAAYwB,IAAI,CAACI,IAAL,CAAUJ,IAAI,CAACE,OAAf,EAAwB,KAAK1B,GAAL,CAAxB,CAAZ;AACD;AACF;AACF;;AAEDgC,EAAAA,OAAO,GAAG;AACR,QAAI,KAAKL,KAAT,EAAgB;AACd,WAAKA,KAAL,CAAWM,OAAX,CAAmB,IAAnB;AACD;AACF;;AAEDrF,EAAAA,OAAO,GAAG;AACR,WAAO,KAAKoB,WAAL,CAAiBpB,OAAjB,EAAP;AACD;;AAhEoB;AAmEvBC,SAAS,CAACwE,MAAV,GAAmB,EAAnB;AACAxE,SAAS,CAACqF,WAAV,GAAwB,IAAxB;;AACArF,SAAS,CAACD,OAAV,GAAoB,YAAW;AAC7B,SAAO,KAAKuF,WAAL,IAAoB,KAAKrF,IAAhC;AACD,CAFD;;ACnEO,MAAMsF,MAAN,CAAa;AAClBC,EAAAA,UAAU,GAAG;AACX,QAAI,KAAKC,iBAAL,CAAuBnF,MAAvB,KAAkC,CAAtC,EAAyC,OAAO,IAAP;;AAEzC,SAAK,IAAIkC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKiD,iBAAL,CAAuBnF,MAA3C,EAAmDkC,CAAC,EAApD,EAAwD;AACtD,UAAIkD,KAAK,GAAG,KAAKD,iBAAL,CAAuBjD,CAAvB,CAAZ;;AACA,UAAIkD,KAAK,CAAC1C,QAAN,CAAe1C,MAAf,KAA0B,CAA9B,EAAiC;AAC/B,eAAO,KAAP;AACD;AACF;;AAED,WAAO,IAAP;AACD;;AAEDP,EAAAA,OAAO,GAAG;AACR,WAAO,KAAKoB,WAAL,CAAiBpB,OAAjB,EAAP;AACD;;AAEDoB,EAAAA,WAAW,CAACwE,KAAD,EAAQC,UAAR,EAAoB;AAC7B,SAAKD,KAAL,GAAaA,KAAb;AACA,SAAKE,OAAL,GAAe,IAAf,CAF6B;;AAK7B,SAAKC,QAAL,GAAgB,EAAhB;AACA,SAAKxC,OAAL,GAAe,EAAf;AAEA,SAAKyC,QAAL,GAAgB,CAAhB,CAR6B;;AAW7B,SAAKC,WAAL,GAAmB,CAAnB;;AAEA,QAAIJ,UAAU,IAAIA,UAAU,CAACG,QAA7B,EAAuC;AACrC,WAAKA,QAAL,GAAgBH,UAAU,CAACG,QAA3B;AACD;;AAED,SAAKN,iBAAL,GAAyB,EAAzB;AAEA,SAAKQ,WAAL,GAAmB,IAAnB;;AAEA,QAAI,KAAK9E,WAAL,CAAiBmC,OAArB,EAA8B;AAC5B,WAAK,IAAI4C,SAAT,IAAsB,KAAK/E,WAAL,CAAiBmC,OAAvC,EAAgD;AAC9C,YAAI6C,WAAW,GAAG,KAAKhF,WAAL,CAAiBmC,OAAjB,CAAyB4C,SAAzB,CAAlB;AACA,YAAI/F,UAAU,GAAGgG,WAAW,CAACpC,UAA7B;;AACA,YAAI,CAAC5D,UAAD,IAAeA,UAAU,CAACG,MAAX,KAAsB,CAAzC,EAA4C;AAC1C,gBAAM,IAAIyC,KAAJ,CAAU,kDAAV,CAAN;AACD;;AACD,YAAI2C,KAAK,GAAG,KAAKC,KAAL,CAAWS,aAAX,CAAyBC,eAAzB,CAAyClG,UAAzC,CAAZ;AACA,aAAK2F,QAAL,CAAcI,SAAd,IAA2BR,KAA3B;;AACA,YAAIS,WAAW,CAACG,SAAZ,KAA0B,IAA9B,EAAoC;AAClC,eAAKb,iBAAL,CAAuBhF,IAAvB,CAA4BiF,KAA5B;AACD;;AACD,aAAKpC,OAAL,CAAa4C,SAAb,IAA0B;AACxBK,UAAAA,OAAO,EAAEb,KAAK,CAAC1C;AADS,SAA1B,CAX8C;;AAgB9C,YAAIwD,WAAW,GAAG,CAAC,OAAD,EAAU,SAAV,EAAqB,SAArB,CAAlB;AAEA,cAAMC,YAAY,GAAG;AACnBC,UAAAA,KAAK,EAAE/D,KAAK,CAACa,SAAN,CAAgBC,YADJ;AAEnBkD,UAAAA,OAAO,EAAEhE,KAAK,CAACa,SAAN,CAAgBG,cAFN;AAGnBiD,UAAAA,OAAO,EAAEjE,KAAK,CAACa,SAAN,CAAgBc,iBAHN;;AAAA,SAArB;;AAMA,YAAI6B,WAAW,CAACU,MAAhB,EAAwB;AACtBL,UAAAA,WAAW,CAAC1D,OAAZ,CAAoBrB,SAAS,IAAI;AAC/B,gBAAI,CAAC,KAAKqF,OAAV,EAAmB;AACjBC,cAAAA,OAAO,CAACC,IAAR,CACG,WAAU,KAAKjH,OAAL,EAAe,gCAA+ByG,WAAW,CAAC7F,IAAZ,CACvD,IADuD,CAEvD,gBAAeuF,SAAU,mDAH7B;AAKD,aAP8B;;;AAU/B,gBAAIC,WAAW,CAACU,MAAZ,CAAmBpF,SAAnB,CAAJ,EAAmC;AACjC,kBAAIwF,KAAK,GAAGd,WAAW,CAACU,MAAZ,CAAmBpF,SAAnB,CAAZ;;AAEA,kBAAIA,SAAS,KAAK,SAAlB,EAA6B;AAC3BiE,gBAAAA,KAAK,CAACxC,QAAN,GAAiB,IAAjB;;AACA,oBAAI+D,KAAK,KAAK,IAAd,EAAoB;AAClB;AACA,sBAAIC,SAAS,GAAI,KAAK5D,OAAL,CAAa4C,SAAb,EAAwBzE,SAAxB,IAAqC,EAAtD;AACAiE,kBAAAA,KAAK,CAACzC,eAAN,CAAsBzB,gBAAtB,CACEmB,KAAK,CAACa,SAAN,CAAgBc,iBADlB,EAEElC,MAAM,IAAI;AACR;AACA,wBAAI8E,SAAS,CAACrF,OAAV,CAAkBO,MAAlB,MAA8B,CAAC,CAAnC,EAAsC;AACpC8E,sBAAAA,SAAS,CAACzG,IAAV,CAAe2B,MAAf;AACD;AACF,mBAPH;AASD,iBAZD,MAYO,IAAI+E,KAAK,CAACC,OAAN,CAAcH,KAAd,CAAJ,EAA0B;AAC/B,sBAAIC,SAAS,GAAI,KAAK5D,OAAL,CAAa4C,SAAb,EAAwBzE,SAAxB,IAAqC,EAAtD;AACAiE,kBAAAA,KAAK,CAACzC,eAAN,CAAsBzB,gBAAtB,CACEmB,KAAK,CAACa,SAAN,CAAgBc,iBADlB,EAEE,CAAClC,MAAD,EAASiF,gBAAT,KAA8B;AAC5B;AACA,wBACEJ,KAAK,CAACpF,OAAN,CAAcwF,gBAAgB,CAAClG,WAA/B,MAAgD,CAAC,CAAjD,IACA+F,SAAS,CAACrF,OAAV,CAAkBO,MAAlB,MAA8B,CAAC,CAFjC,EAGE;AACA8E,sBAAAA,SAAS,CAACzG,IAAV,CAAe2B,MAAf;AACD;AACF,mBAVH;AAYD,iBAdM;AAoCR,eAlDD,MAkDO;AACL,oBAAI8E,SAAS,GAAI,KAAK5D,OAAL,CAAa4C,SAAb,EAAwBzE,SAAxB,IAAqC,EAAtD;AAEAiE,gBAAAA,KAAK,CAACzC,eAAN,CAAsBzB,gBAAtB,CACEiF,YAAY,CAAChF,SAAD,CADd,EAEEW,MAAM,IAAI;AACR;AACA,sBAAI8E,SAAS,CAACrF,OAAV,CAAkBO,MAAlB,MAA8B,CAAC,CAAnC,EACE8E,SAAS,CAACzG,IAAV,CAAe2B,MAAf;AACH,iBANH;AAQD;AACF;AACF,WA5ED;AA6ED;AACF;AACF;AACF;;AAEDkF,EAAAA,IAAI,GAAG;AACL,SAAKtB,WAAL,GAAmB,CAAnB;AACA,SAAKH,OAAL,GAAe,KAAf;AACD;;AAED0B,EAAAA,IAAI,GAAG;AACL,SAAK1B,OAAL,GAAe,IAAf;AACD,GA1JiB;;;AA6JlB2B,EAAAA,WAAW,GAAG;AACZ,SAAK,IAAItB,SAAT,IAAsB,KAAK5C,OAA3B,EAAoC;AAClC,UAAIoC,KAAK,GAAG,KAAKpC,OAAL,CAAa4C,SAAb,CAAZ;;AACA,UAAIR,KAAK,CAACgB,KAAV,EAAiB;AACfhB,QAAAA,KAAK,CAACgB,KAAN,CAAYpG,MAAZ,GAAqB,CAArB;AACD;;AACD,UAAIoF,KAAK,CAACiB,OAAV,EAAmB;AACjBjB,QAAAA,KAAK,CAACiB,OAAN,CAAcrG,MAAd,GAAuB,CAAvB;AACD;;AACD,UAAIoF,KAAK,CAACkB,OAAV,EAAmB;AACjB,YAAIO,KAAK,CAACC,OAAN,CAAc1B,KAAK,CAACkB,OAApB,CAAJ,EAAkC;AAChClB,UAAAA,KAAK,CAACkB,OAAN,CAActG,MAAd,GAAuB,CAAvB;AACD,SAFD,MAEO;AACL,eAAK,IAAIL,IAAT,IAAiByF,KAAK,CAACkB,OAAvB,EAAgC;AAC9BlB,YAAAA,KAAK,CAACkB,OAAN,CAAc3G,IAAd,EAAoBK,MAApB,GAA6B,CAA7B;AACD;AACF;AACF;AACF;AACF;;AAEDwD,EAAAA,MAAM,GAAG;AACP,QAAI2D,IAAI,GAAG;AACTxH,MAAAA,IAAI,EAAE,KAAKF,OAAL,EADG;AAET8F,MAAAA,OAAO,EAAE,KAAKA,OAFL;AAGTG,MAAAA,WAAW,EAAE,KAAKA,WAHT;AAITD,MAAAA,QAAQ,EAAE,KAAKA,QAJN;AAKTzC,MAAAA,OAAO,EAAE;AALA,KAAX;;AAQA,QAAI,KAAKnC,WAAL,CAAiBmC,OAArB,EAA8B;AAC5B,UAAIA,OAAO,GAAG,KAAKnC,WAAL,CAAiBmC,OAA/B;;AACA,WAAK,IAAI4C,SAAT,IAAsB5C,OAAtB,EAA+B;AAC7B,YAAIoC,KAAK,GAAG,KAAKpC,OAAL,CAAa4C,SAAb,CAAZ;AACA,YAAIwB,eAAe,GAAGpE,OAAO,CAAC4C,SAAD,CAA7B;AACA,YAAIyB,SAAS,GAAIF,IAAI,CAACnE,OAAL,CAAa4C,SAAb,IAA0B;AACzC/C,UAAAA,GAAG,EAAE,KAAK2C,QAAL,CAAcI,SAAd,EAAyB/C;AADW,SAA3C;AAIAwE,QAAAA,SAAS,CAACrB,SAAV,GAAsBoB,eAAe,CAACpB,SAAhB,KAA8B,IAApD;AACAqB,QAAAA,SAAS,CAACzE,QAAV,GACEwE,eAAe,CAACb,MAAhB,KACCa,eAAe,CAACb,MAAhB,CAAuBH,KAAvB,KAAiC,IAAjC,IACCgB,eAAe,CAACb,MAAhB,CAAuBF,OAAvB,KAAmC,IADpC,IAECe,eAAe,CAACb,MAAhB,CAAuBD,OAAvB,KAAmC,IAFpC,IAGCO,KAAK,CAACC,OAAN,CAAcM,eAAe,CAACb,MAAhB,CAAuBD,OAArC,CAJF,CADF;;AAOA,YAAIe,SAAS,CAACzE,QAAd,EAAwB;AACtByE,UAAAA,SAAS,CAACd,MAAV,GAAmB,EAAnB;AAEA,gBAAMe,OAAO,GAAG,CAAC,OAAD,EAAU,SAAV,EAAqB,SAArB,CAAhB;AACAA,UAAAA,OAAO,CAAC9E,OAAR,CAAgB+E,MAAM,IAAI;AACxB,gBAAInC,KAAK,CAACmC,MAAD,CAAT,EAAmB;AACjBF,cAAAA,SAAS,CAACd,MAAV,CAAiBgB,MAAjB,IAA2B;AACzB7E,gBAAAA,QAAQ,EAAE0C,KAAK,CAACmC,MAAD,CAAL,CAAcvH;AADC,eAA3B;AAGD;AACF,WAND;AAOD;AACF;AACF;;AAED,WAAOmH,IAAP;AACD;;AA5NiB;AA+NpBlC,MAAM,CAACuC,QAAP,GAAkB,IAAlB;;AACAvC,MAAM,CAACxF,OAAP,GAAiB,YAAW;AAC1B,SAAO,KAAKuF,WAAL,IAAoB,KAAKrF,IAAhC;AACD,CAFD;;AClOO,MAAM8H,SAAS,GAAGC,GAAG,IAAIA,GAAzB;AAEP,AAAO,MAAMC,UAAU,GAAGD,GAAG,IAAIA,GAA1B;AAEP,AAAO,MAAME,SAAS,GAAG,CAACF,GAAD,EAAMG,IAAN,KAAe;AACtC,MAAI,CAACH,GAAL,EAAU;AACR,WAAOA,GAAP;AACD;;AAED,MAAI,CAACG,IAAL,EAAW;AACT,WAAOH,GAAG,CAACzF,KAAJ,EAAP;AACD;;AAED4F,EAAAA,IAAI,CAAC7H,MAAL,GAAc,CAAd;;AAEA,OAAK,IAAIkC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwF,GAAG,CAAC1H,MAAxB,EAAgCkC,CAAC,EAAjC,EAAqC;AACnC2F,IAAAA,IAAI,CAAC1H,IAAL,CAAUuH,GAAG,CAACxF,CAAD,CAAb;AACD;;AAED,SAAO2F,IAAP;AACD,CAhBM;AAkBP,AAAO,MAAMC,UAAU,GAAGJ,GAAG,IAAIA,GAAG,IAAIA,GAAG,CAACzF,KAAJ,EAAjC;AAEP,AAAO,MAAM8F,QAAQ,GAAGL,GAAG,IAAIM,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeR,GAAf,CAAX,CAAxB;AAEP,AAAO,MAAMS,SAAS,GAAGT,GAAG,IAAIM,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeR,GAAf,CAAX,CAAzB;AAEP,AAcO,SAASU,UAAT,CAAoBC,cAApB,EAAoC;AACzC,MAAIC,mBAAmB,GAAG,CAAC,MAAD,EAAS,SAAT,EAAoB,MAApB,EAA4B,OAA5B,CAA1B;AAEA,MAAIC,mBAAmB,GAAGD,mBAAmB,CAACE,MAApB,CAA2BC,CAAC,IAAI;AACxD,WAAO,CAACJ,cAAc,CAAClE,cAAf,CAA8BsE,CAA9B,CAAR;AACD,GAFyB,CAA1B;;AAIA,MAAIF,mBAAmB,CAACvI,MAApB,GAA6B,CAAjC,EAAoC;AAClC,UAAM,IAAIyC,KAAJ,CACH,uEAAsE8F,mBAAmB,CAAClI,IAApB,CACrE,IADqE,CAErE,EAHE,CAAN;AAKD;;AAEDgI,EAAAA,cAAc,CAACK,MAAf,GAAwB,IAAxB;AAEA,SAAOL,cAAP;AACD;AAED;;;;AAGA,AAAO,MAAMM,KAAK,GAAG;AACnBC,EAAAA,MAAM,EAAER,UAAU,CAAC;AACjBzI,IAAAA,IAAI,EAAE,QADW;AAEjB4E,IAAAA,OAAO,EAAE,CAFQ;AAGjBE,IAAAA,IAAI,EAAEgD,SAHW;AAIjBnD,IAAAA,KAAK,EAAEqD;AAJU,GAAD,CADC;AAQnBkB,EAAAA,OAAO,EAAET,UAAU,CAAC;AAClBzI,IAAAA,IAAI,EAAE,SADY;AAElB4E,IAAAA,OAAO,EAAE,KAFS;AAGlBE,IAAAA,IAAI,EAAEgD,SAHY;AAIlBnD,IAAAA,KAAK,EAAEqD;AAJW,GAAD,CARA;AAenBmB,EAAAA,MAAM,EAAEV,UAAU,CAAC;AACjBzI,IAAAA,IAAI,EAAE,QADW;AAEjB4E,IAAAA,OAAO,EAAE,EAFQ;AAGjBE,IAAAA,IAAI,EAAEgD,SAHW;AAIjBnD,IAAAA,KAAK,EAAEqD;AAJU,GAAD,CAfC;AAsBnBd,EAAAA,KAAK,EAAEuB,UAAU,CAAC;AAChBzI,IAAAA,IAAI,EAAE,OADU;AAEhB4E,IAAAA,OAAO,EAAE,EAFO;AAGhBE,IAAAA,IAAI,EAAEmD,SAHU;AAIhBtD,IAAAA,KAAK,EAAEwD;AAJS,GAAD,CAtBE;AA6BnBiB,EAAAA,GAAG,EAAEX,UAAU,CAAC;AACdzI,IAAAA,IAAI,EAAE,KADQ;AAEd4E,IAAAA,OAAO,EAAEjD,SAFK;AAGdmD,IAAAA,IAAI,EAAEgD,SAHQ;AAIdnD,IAAAA,KAAK,EAAEqD;AAJO,GAAD,CA7BI;AAoCnBK,EAAAA,IAAI,EAAEI,UAAU,CAAC;AACfzI,IAAAA,IAAI,EAAE,MADS;AAEf4E,IAAAA,OAAO,EAAE,IAFM;AAGfE,IAAAA,IAAI,EAAEsD,QAHS;AAIfzD,IAAAA,KAAK,EAAE6D;AAJQ,GAAD;AApCG,CAAd;;ACjEA,SAASa,UAAT,CAAoBhJ,MAApB,EAA4B;AACjC,MAAIiJ,MAAM,GAAG,EAAb;AACA,MAAIC,UAAU,GAAG,sCAAjB;AACA,MAAIC,gBAAgB,GAAGD,UAAU,CAAClJ,MAAlC;;AACA,OAAK,IAAIkC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlC,MAApB,EAA4BkC,CAAC,EAA7B,EAAiC;AAC/B+G,IAAAA,MAAM,IAAIC,UAAU,CAACE,MAAX,CAAkBC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBJ,gBAA3B,CAAlB,CAAV;AACD;;AACD,SAAOF,MAAP;AACD;AAED,AAAO,SAASO,YAAT,CAAsB9B,GAAtB,EAA2B+B,MAA3B,EAAmC;AACxC,MAAIC,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb,CADwC;;AAGxCF,EAAAA,MAAM,CAAChC,GAAP,GAAaA,GAAb;AACAgC,EAAAA,MAAM,CAACG,MAAP,GAAgBJ,MAAhB;AACA,GAACE,QAAQ,CAACG,IAAT,IAAiBH,QAAQ,CAACI,eAA3B,EAA4CC,WAA5C,CAAwDN,MAAxD;AACD;;AChBD;AACA;AAGA,SAASO,oBAAT,CAA8BC,UAA9B,EAA0C;AACxC,MAAIC,aAAa,GAAG,CAAC,OAAD,EAAU,SAAV,EAAqB,KAArB,CAApB;AACAA,EAAAA,aAAa,CAAC3H,OAAd,CAAsBK,GAAG,IAAI;AAC3B,QAAI,OAAO4D,OAAO,CAAC5D,GAAD,CAAd,KAAwB,UAA5B,EAAwC;AACtC,UAAIuH,EAAE,GAAG3D,OAAO,CAAC5D,GAAD,CAAP,CAAanC,IAAb,CAAkB+F,OAAlB,CAAT;;AACAA,MAAAA,OAAO,CAAC5D,GAAD,CAAP,GAAe,CAAC,GAAGwH,IAAJ,KAAa;AAC1BH,QAAAA,UAAU,CAACI,IAAX,CAAgB;AACd/C,UAAAA,MAAM,EAAE,SADM;AAEdlD,UAAAA,IAAI,EAAExB,GAFQ;AAGdwH,UAAAA,IAAI,EAAErC,IAAI,CAACE,SAAL,CAAemC,IAAf;AAHQ,SAAhB;AAKA,eAAOD,EAAE,CAACG,KAAH,CAAS,IAAT,EAAeF,IAAf,CAAP;AACD,OAPD;AAQD;AACF,GAZD;AAcA9J,EAAAA,MAAM,CAACW,gBAAP,CAAwB,OAAxB,EAAiCsJ,KAAK,IAAI;AACxCN,IAAAA,UAAU,CAACI,IAAX,CAAgB;AACd/C,MAAAA,MAAM,EAAE,OADM;AAEdiD,MAAAA,KAAK,EAAExC,IAAI,CAACE,SAAL,CAAe;AACpBuC,QAAAA,OAAO,EAAED,KAAK,CAACA,KAAN,CAAYC,OADD;AAEpBC,QAAAA,KAAK,EAAEF,KAAK,CAACA,KAAN,CAAYE;AAFC,OAAf;AAFO,KAAhB;AAOD,GARD;AASD;;AAED,SAASC,mBAAT,CAA6BC,QAA7B,EAAuC;AACrC,MAAIC,OAAO,GAAGlB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAd;AACAiB,EAAAA,OAAO,CAACC,KAAR,CAAcC,OAAd,GAAyB;;;;;;;;;;;;;;;GAAzB;AAiBAF,EAAAA,OAAO,CAACG,SAAR,GAAqB,0FAAyFJ,QAAS,0EAAvH;AACAjB,EAAAA,QAAQ,CAACsB,IAAT,CAAcjB,WAAd,CAA0Ba,OAA1B;AAEA,SAAOA,OAAP;AACD;;AAED,AAAO,SAASK,oBAAT,CAA8BN,QAA9B,EAAwC;AAC7C,MAAI,CAACtK,SAAL,EAAgB;AACdmG,IAAAA,OAAO,CAACC,IAAR,CAAa,mDAAb;AACA;AACD;;AAEDnG,EAAAA,MAAM,CAAC4K,eAAP,GAAyB,MAAM;AAC7B5K,IAAAA,MAAM,CAAC6K,YAAP,CAAoBC,KAApB;AACAT,IAAAA,QAAQ,GAAG5B,UAAU,CAAC,CAAD,CAArB;AACAzI,IAAAA,MAAM,CAAC6K,YAAP,CAAoBE,OAApB,CAA4B,cAA5B,EAA4CV,QAA5C;AACArK,IAAAA,MAAM,CAACgL,QAAP,CAAgBC,MAAhB,CAAuB,KAAvB;AACD,GALD;;AAOAZ,EAAAA,QAAQ,GAAGA,QAAQ,IAAIrK,MAAM,CAAC6K,YAAP,CAAoBK,OAApB,CAA4B,cAA5B,CAAvB;;AACA,MAAI,CAACb,QAAL,EAAe;AACbA,IAAAA,QAAQ,GAAG5B,UAAU,CAAC,CAAD,CAArB;AACAzI,IAAAA,MAAM,CAAC6K,YAAP,CAAoBE,OAApB,CAA4B,cAA5B,EAA4CV,QAA5C;AACD;;AAED,MAAIC,OAAO,GAAGF,mBAAmB,CAACC,QAAD,CAAjC;AAEArK,EAAAA,MAAM,CAACmL,+BAAP,GAAyC,IAAzC;AACAnL,EAAAA,MAAM,CAACoL,sBAAP,GAAgC,EAAhC;AAEA,MAAIC,OAAO,GAAG,EAAd,CAxB6C;;AA2B7C,MAAIC,mBAAmB,GAAG,EAA1B;;AACA,MAAIC,cAAc,GAAGC,CAAC,IAAI;AACxB,QAAI1G,KAAK,GAAG0G,CAAC,CAACC,MAAF,CAAS3G,KAArB;AACAuG,IAAAA,OAAO,GAAGG,CAAC,CAACC,MAAF,CAASC,OAAnB;AACAJ,IAAAA,mBAAmB,CAAC1L,IAApB,CAAyBkF,KAAzB;AACD,GAJD;;AAKA9E,EAAAA,MAAM,CAACW,gBAAP,CAAwB,oBAAxB,EAA8C4K,cAA9C;;AAEA,MAAII,QAAQ,GAAG,MAAM;AACnB,QAAIC,IAAI,GAAG,IAAIC,IAAJ,CAASxB,QAAT,CAAX;AACAuB,IAAAA,IAAI,CAACE,EAAL,CAAQ,MAAR,EAAgB;AAAC;AAAa;AAC5BF,MAAAA,IAAI,CAACE,EAAL,CAAQ,YAAR,EAAsBnC,UAAU,IAAI;AAClC3J,QAAAA,MAAM,CAACoL,sBAAP,CAA8BzB,UAA9B,GAA2CA,UAA3C;AACAA,QAAAA,UAAU,CAACmC,EAAX,CAAc,MAAd,EAAsB,YAAW;AAC/B;AACAxB,UAAAA,OAAO,CAACG,SAAR,GAAoB,WAApB,CAF+B;;AAK/Bd,UAAAA,UAAU,CAACmC,EAAX,CAAc,MAAd,EAAsB,UAASC,IAAT,EAAe;AACnC,gBAAIA,IAAI,CAACjI,IAAL,KAAc,MAAlB,EAA0B;AACxB,kBAAIqF,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;AACAF,cAAAA,MAAM,CAAC6C,YAAP,CAAoB,MAApB,EAA4B,iBAA5B;;AACA7C,cAAAA,MAAM,CAACG,MAAP,GAAgB,MAAM;AACpBH,gBAAAA,MAAM,CAAC8C,UAAP,CAAkBC,WAAlB,CAA8B/C,MAA9B,EADoB;;AAIpBnJ,gBAAAA,MAAM,CAACkB,mBAAP,CACE,oBADF,EAEEqK,cAFF;AAIAD,gBAAAA,mBAAmB,CAACrJ,OAApB,CAA4B6C,KAAK,IAAI;AACnC,sBAAIsB,KAAK,GAAG,IAAI+F,WAAJ,CAAgB,oBAAhB,EAAsC;AAChDV,oBAAAA,MAAM,EAAE;AAAE3G,sBAAAA,KAAK,EAAEA,KAAT;AAAgB4G,sBAAAA,OAAO,EAAEL;AAAzB;AADwC,mBAAtC,CAAZ;AAGArL,kBAAAA,MAAM,CAACsB,aAAP,CAAqB8E,KAArB;AACD,iBALD;AAMD,eAdD;;AAeA+C,cAAAA,MAAM,CAACsB,SAAP,GAAmBsB,IAAI,CAAC5C,MAAxB;AACA,eAACC,QAAQ,CAACG,IAAT,IAAiBH,QAAQ,CAACI,eAA3B,EAA4CC,WAA5C,CAAwDN,MAAxD;AACAA,cAAAA,MAAM,CAACG,MAAP;AAEAI,cAAAA,oBAAoB,CAACC,UAAD,CAApB;AACD,aAvBD,MAuBO,IAAIoC,IAAI,CAACjI,IAAL,KAAc,eAAlB,EAAmC;AACxC,kBAAIsI,KAAK,GAAGC,IAAI,CAACN,IAAI,CAAC5C,MAAN,CAAhB;;AACA,kBAAI4C,IAAI,CAACO,UAAT,EAAqB;AACnB3C,gBAAAA,UAAU,CAACI,IAAX,CAAgB;AACd/C,kBAAAA,MAAM,EAAE,YADM;AAEdoF,kBAAAA,KAAK,EAAEA;AAFO,iBAAhB;AAID;AACF;AACF,WAjCD;AAkCD,SAvCD;AAwCD,OA1CD;AA2CD,KA5CD;AA6CD,GA/CD,CAnC6C;;;AAqF7CnD,EAAAA,YAAY,CACV,6DADU,EAEV0C,QAFU,CAAZ;AAID;;AAED,IAAI5L,SAAJ,EAAe;AACb,QAAMwM,SAAS,GAAG,IAAIC,eAAJ,CAAoBxM,MAAM,CAACgL,QAAP,CAAgByB,MAApC,CAAlB,CADa;;AAIb,MAAIF,SAAS,CAACG,GAAV,CAAc,wBAAd,CAAJ,EAA6C;AAC3C/B,IAAAA,oBAAoB;AACrB;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}